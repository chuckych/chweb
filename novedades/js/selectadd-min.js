$(document).ready((function(){HoraMask(".HoraMask"),$(document).on("click","#addNov",(function(e){CheckSesion();var n=parseFloat($("#AnioMin").val()),r=parseFloat($("#AnioMax").val());$("#_draddNov").daterangepicker({singleDatePicker:!1,showDropdowns:!1,minYear:n,maxYear:r,showWeekNumbers:!1,autoUpdateInput:!0,opens:"center",drops:"down",autoApply:!1,alwaysShowCalendars:!0,linkedCalendars:!1,buttonClasses:"btn btn-sm fontq",applyButtonClasses:"btn-custom fw4 px-3 opa8",cancelClass:"btn-link fw4 text-gris",ranges:{Hoy:[moment(),moment()],"Esta semana":[moment().day(1),moment().day(7)],"Ultima Semana":[moment().subtract(1,"week").day(1),moment().subtract(1,"week").day(7)],"Próxima Semana":[moment().add(1,"week").day(1),moment().add(1,"week").day(7)],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Próximo Mes":[moment().add(1,"month").startOf("month"),moment().add(1,"month").endOf("month")]},locale:{format:"DD/MM/YYYY",separator:" al ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Para",customRangeLabel:"Personalizado",weekLabel:"Sem",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1,alwaysShowCalendars:!0,applyButtonClasses:"btn-custom fw5 px-3 opa8"}}),$("#_draddNov").on("apply.daterangepicker",(function(e,a){$("#range").submit()})),$("#Encabezado").html("Ingresar Novedades"),$("#divTablas").addClass("d-none"),$("#divaddNov").removeClass("d-none"),fadeInOnly("#divaddNov");var l="0",t="10";function s(e,n){$(e).on("select2:select",(function(r){var l=$(e+" :selected").text();$(n).val(l).trigger("change"),function(e){var a=parseFloat($(e).val()),n=parseFloat(a+1);$(e).val(0),$(e).val(n)}("#Cuenta"),a.ajax.reload()}))}function o(e){$(e).on("select2:unselecting",(function(e){!function(e){var a=parseFloat($(e).val()),n=parseFloat(a-1);$(e).val(0),$(e).val(n)}("#Cuenta"),a.ajax.reload()}))}SelectSelect2(".select2Tipo",!0,"Tipo de Personal",0,-1,10,!1),$(".sel_empresa").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Empresa",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerEmpresas.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Tipo:$("#aTipo").val(),Plan:$("#aPlan").val(),Sect:$("#aSect").val(),Sec2:$("#aSec2").val(),Grup:$("#aGrup").val(),Sucur:$("#aSucur").val()}},processResults:function(e){return{results:e}}}}),$(".sel_plantas").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Planta",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerPlantas.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Tipo:$("#aTipo").val(),Emp:$("#aEmp").val(),Sect:$("#aSect").val(),Sec2:$("#aSec2").val(),Grup:$("#aGrup").val(),Sucur:$("#aSucur").val()}},processResults:function(e){return{results:e}}}}),$(".sel_sectores").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Sector",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerSectores.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Tipo:$("#aTipo").val(),Emp:$("#aEmp").val(),Plan:$("#aPlan").val(),Sec2:$("#aSec2").val(),Grup:$("#aGrup").val(),Sucur:$("#aSucur").val()}},processResults:function(e){return{results:e}}}}),$(".sel_seccion").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Sección",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerSecciones.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Sect:$("#aSect").val()}},processResults:function(e){return{results:e}}}}),$(".sel_grupos").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Grupo",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerGrupos.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Tipo:$("#aTipo").val(),Emp:$("#aEmp").val(),Plan:$("#aPlan").val(),Sect:$("#aSect").val(),Sec2:$("#aSec2").val(),Sucur:$("#aSucur").val()}},processResults:function(e){return{results:e}}}}),$(".sel_sucursal").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Sucursal",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getPerSucursales.php",dataType:"json",type:"GET",delay:"250",data:function(e){return{q:e.term,Tipo:$("#aTipo").val(),Emp:$("#aEmp").val(),Plan:$("#aPlan").val(),Sect:$("#aSect").val(),Sec2:$("#aSec2").val(),Grup:$("#aGrup").val()}},processResults:function(e){return{results:e}}}}),$(".sel_causa").select2({multiple:!1,language:"es",allowClear:!0,placeholder:"Causa",minimumInputLength:"0",minimumResultsForSearch:"5",maximumInputLength:"10",selectOnClose:!0,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+t+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"},removeAllItems:function(){return"Eliminar Selección"}},ajax:{url:"/"+$("#_homehost").val()+"/data/getListNoveCausa.php",dataType:"json",type:"POST",delay:"250",data:function(e){return{q:e.term,NovCNove:$("#aFicNove").val()}},processResults:function(e){return{results:e}}}}),SelectSelect2Ajax(".sel_novedad",!1,!0,"Novedad",0,5,10,!0,"data/getNovNovedades.php","250","","POST"),CloseDropdownOnClearSelect2(".sel_causa"),CloseDropdownOnClearSelect2(".sel_empresa"),CloseDropdownOnClearSelect2(".sel_plantas"),CloseDropdownOnClearSelect2(".sel_sectores"),CloseDropdownOnClearSelect2(".sel_seccion"),CloseDropdownOnClearSelect2(".sel_grupos"),CloseDropdownOnClearSelect2(".sel_sucursal"),$(".sel_seccion").prop("disabled",!0),$(".sel_causa").prop("disabled",!0),$(".sel_sectores").on("select2:select",(function(e){$(".sel_seccion").prop("disabled",!1),$("#select_seccion").removeClass("d-none"),$(".sel_seccion").val(null).trigger("change")})),$(".sel_sectores").on("select2:unselecting",(function(e){$(".sel_seccion").val(null).trigger("change"),$(".sel_seccion").prop("disabled",!0),setTimeout((function(){$(".check").prop("checked",!0)}),1e3)})),$(".sel_novedad").on("select2:select",(function(e){$(".sel_causa").prop("disabled",!1),$("#select_causa").removeClass("d-none"),fadeInOnly("#select_causa"),$(".sel_causa").val(null).trigger("change"),$(".FicHoras").focus(),$("#SelNovedad").val($(".sel_novedad :selected").text()).trigger("change")})),$(".sel_novedad").on("select2:unselecting",(function(e){$(".sel_causa").val(null).trigger("change"),$(".sel_causa").prop("disabled",!0),$("#select_causa").addClass("d-none")})),$(".sel_novedad").on("select2:opening",(function(e){setTimeout((()=>{$(".select2-search__field").focus()}),500)})),$("#Cuenta").val(0),s(".sel_empresa","#SelEmpresa"),s(".sel_plantas","#SelPlanta"),s(".sel_sectores","#SelSector"),s(".sel_seccion","#SelSeccion"),s(".sel_grupos","#SelGrupo"),s(".sel_sucursal","#SelSucursal"),o(".sel_empresa"),o(".sel_plantas"),o(".sel_sectores"),o(".sel_seccion"),o(".sel_grupo"),o(".sel_sucursal"),$("#aTipo").change((function(){CheckSesion(),$(".sel_sucursal").val(null).trigger("change"),$("#SelSucursal").val(null).trigger("change"),$(".sel_grupos").val(null).trigger("change"),$("#SelGrupo").val(null).trigger("change"),$(".sel_seccion").val(null).trigger("change"),$("#SelSeccion").val(null).trigger("change"),$(".sel_sectores").val(null).trigger("change"),$(".sel_seccion").val(null).trigger("change"),$("#SelSector").val(null).trigger("change"),$("#SelSeccion").val(null).trigger("change"),$(".sel_personal").val(null).trigger("change"),$(".sel_plantas").val(null).trigger("change"),$("#SelPlanta").val(null).trigger("change"),$(".sel_empresa").val(null).trigger("change"),$("#SelEmpresa").val(null).trigger("change"),a.ajax.reload(),setTimeout((function(){$(".check").prop("checked",!0)}),1e3),$("#Cuenta").val(0)}))})),$(".check").prop("disabled",!0),$("#TipoIngreso").val(1),$("#TipoIngreso1").change((function(){CheckSesion(),$("#TipoIngreso1").is(":checked")&&($("#TipoIngreso").val(1),$(".check").prop("disabled",!0))})),$("#TipoIngreso2").change((function(){CheckSesion(),$("#TipoIngreso2").is(":checked")&&($("#TipoIngreso").val(2),$(".check").prop("disabled",!1))}));function e(){CheckSesion(),$("#Cuenta").val(0),$("#SelEmpresa").val(null).trigger("change"),$("#SelPlanta").val(null).trigger("change"),$("#SelSector").val(null).trigger("change"),$("#SelSeccion").val(null).trigger("change"),$("#SelGrupo").val(null).trigger("change"),$("#SelSucursal").val(null).trigger("change"),$(".sel_plantas").val(null).trigger("change"),$(".sel_empresa").val(null).trigger("change"),$(".sel_sectores").val(null).trigger("change"),$(".sel_seccion").val(null).trigger("change"),$(".sel_grupos").val(null).trigger("change"),$(".sel_sucursal").val(null).trigger("change"),$(".sel_personal").val(null).trigger("change"),$(".sel_novedad").val(null).trigger("change"),$(".sel_seccion").prop("disabled",!0),$("#aFicCate").prop("checked",!1),$("#aLaboral").prop("checked",!1),$("#aFicJust").prop("checked",!1),$("#aFicObse").val(null).trigger("change"),$("#aFicHoras").val(null).trigger("change"),$("#respuetatext").removeClass("animate__animated animate__fadeIn"),$("#respuetatext").html(""),ActiveBTN(!1,"#submit","Ingresando","Ingresar"),$("#respuesta").removeClass("alert-success"),$("#respuesta").removeClass("alert-danger"),$("#respuesta").removeClass("alert-info"),$(".sel_causa").val(null).trigger("change"),$(".sel_causa").prop("disabled",!0),$("#select_causa").addClass("d-none")}ActiveBTN(!1,"#submit","Ingresando","Ingresar"),$(".alta_novedad").bind("submit",(function(n){n.preventDefault(),CheckSesion();var r=$.now();let l=new Array;$(".checkLega:checked").each((function(){l.push($(this).val())}));$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize()+"&alta_novedad="+!0+"&now="+r+"&legajos="+l,beforeSend:function(e){$.notifyClose(),notify('Aguarde <span class = "dotting mr-1"> </span> <div class="spinner-border fontppp" role="status" style="width: 15px; height:15px" ></div>',"dark",6e4,"right"),ActiveBTN(!0,"#submit","Ingresando","Ingresar")},success:function(n){"ok"==n.status?($.notifyClose(),notify(n.Mensaje,"success",2e3,"right"),n.ErrorTotal>0&&(notify('<div class=""><span class="fonth">No se pudo ingresar la novedad en los siguientes registros.</span><div class="overflow-auto pr-3 table-responsive" style="max-height:300px"><table id="presentes" class="w-100 mt-2"><thead><tr><td><span class="fontq fw5">Fecha</span></td><td><span class="fontq fw5">Legajo</span></td><td><span class="fontq fw5">Nombre</span></td><td><tr></thead><tbody></tbody></table></div></div>',"warning",0,"right"),setTimeout((()=>{$.each(n.Errores,(function(e,a){$("#presentes tbody").append('<tr class="animate__animated animate__fadeIn"><td class="p-0 m-0"><span class="fontq ls1">'+a.Fecha+'</span></td><td class="p-0 m-0"><span class="fontq">'+a.Legajo+'</span></td><td class="p-0 m-0"><span class="fontq">'+a.Nombre+"</span></td></tr>")}))}),500)),e(),ActiveBTN(!1,"#submit","Ingresando","Ingresar"),a.ajax.reload(),ActualizaTablas()):($.notifyClose(),notify(n.Mensaje,"danger",0,"right"),ActiveBTN(!1,"#submit","Ingresando","Ingresar"))},error:function(e,a){if($.notifyClose(),0===e.status)var n="No hay Conexión";else if(404==e.status)n="No se encontró la página solicitada [404]";else if(500==e.status)n="Error de servidor interno [500].";else if("parsererror"===a)n="Error de análisis JSON solicitado.";else if("timeout"===a)n="Error de tiempo de espera.";else if("abort"===a)n="Solicitud cancelada.";else n="Error no detectado: "+e.responseText;notify(n,"danger",5e3,"right"),notify('<div class="fw5 fonth">Error</div>'+e.responseText,"danger",0,"right"),ActiveBTN(!1,"#submit","Ingresando","Ingresar")}}),n.stopImmediatePropagation()})),$("#trash_allFilter").on("click",(function(){e(),a.page.len(10).draw()})),$("#Personal-select-all").addClass("check");let a=$("#GetPers").DataTable({initComplete:function(e,a){$("div.loader").remove()},drawCallback:function(e){let a=e._iDisplayStart,n=e._iDisplayLength;$("#pagIni").val(a),$("#pagFin").val(n),setTimeout((()=>{$(".check").prop("checked",!0),$("#divTablePers").removeClass("d-none"),1==$("#TipoIngreso").val()&&$(".check").prop("disabled",!0)}),500)},bProcessing:!0,serverSide:!0,deferRender:!0,searchDelay:1500,ajax:{url:"/"+_homehost+"/novedades/?p=array_personal.php",type:"GET",data:function(e){e.Tipo=$("#aTipo").val(),e.Emp=$("#aEmp").val(),e.Plan=$("#aPlan").val(),e.Sect=$("#aSect").val(),e.Sec2=$("#aSec2").val(),e.Grup=$("#aGrup").val(),e.Sucur=$("#aSucur").val(),e._c=$("#_c").val(),e._r=$("#_r").val(),e.Modulo="Cierres",e.NoPag=!0},error:function(){$("#GetPers_processing").css("display","none")}},columns:[{class:"align-middle animate__animated animate__fadeIn w10",data:"check"},{class:"align-middle animate__animated animate__fadeIn w80",data:"pers_legajo2"},{class:"align-middle animate__animated animate__fadeIn w300",data:"pers_nombre2"}],scrollY:"335px",scrollX:!0,paging:!1,responsive:!1,searching:!0,info:!0,ordering:!1,language:{url:"../js/DataTableSpanishShort.json"}});a.on("page.dt",(function(){CheckSesion(),setTimeout((function(){$(".check").prop("checked",!0),$("#EliminaCierre").prop("checked",!1)}),1e3)})),a.on("page",(function(){$(".check").prop("checked",!1)})),$("#Personal-select-all").on("click",(function(){CheckSesion();var e=a.rows({search:"applied"}).nodes();$(".check",e).prop("checked",this.checked)})),$("#GetPers tbody").on("change",".check",(function(){if(!this.checked){var e=$("#Personal-select-all").get(0);e&&e.checked&&"indeterminate"in e&&(e.indeterminate=!0)}})),$("#Cuenta").change((function(){a()})),$(document).on("click","#CloseaddNov",(function(e){$("#SelEmpresa").val(null).trigger("change"),$("#SelPlanta").val(null).trigger("change"),$("#SelSector").val(null).trigger("change"),$("#SelSeccion").val(null).trigger("change"),$("#SelGrupo").val(null).trigger("change"),$("#SelSucursal").val(null).trigger("change"),$(".sel_plantas").val(null).trigger("change"),$(".sel_empresa").val(null).trigger("change"),$(".sel_sectores").val(null).trigger("change"),$(".sel_seccion").val(null).trigger("change"),$(".sel_grupos").val(null).trigger("change"),$(".sel_sucursal").val(null).trigger("change"),$(".sel_personal").val(null).trigger("change"),$(".sel_novedad").val(null).trigger("change"),$(".sel_seccion").prop("disabled",!0),$("#FicCate").prop("checked",!1),$("#Laboral").prop("checked",!1),$("#FicJust").prop("checked",!1),$("#FicObse").val(null).trigger("change"),$("#FicHoras").val(null).trigger("change"),$("#respuetatext").removeClass("animate__animated animate__fadeIn"),$("#respuetatext").html(""),ActiveBTN(!1,"#submit","Ingresando","Ingresar"),$("#respuesta").removeClass("alert-success"),$("#respuesta").removeClass("alert-danger"),$("#respuesta").removeClass("alert-info"),$(".sel_causa").val(null).trigger("change"),$(".sel_causa").prop("disabled",!0),$("#select_causa").addClass("d-none"),a.search(this.value).draw(),a.page.len(10).draw(),$("#divTablePers").addClass("d-none"),$("#divTablas").removeClass("d-none"),$("#divaddNov").addClass("d-none"),fadeInOnly("#divTablas"),$("#Encabezado").html("Novedades")}))}));