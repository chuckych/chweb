$((function(){function e(){return $("#_homehost").val()+"_"+$("#_lega").val()}var e=e();if(sessionStorage.getItem(e+"_range"))var t=sessionStorage.getItem(e+"_range").split(" al "),a=t[0],r=t[1];else a=moment().subtract(6,"month").format("DD/MM/YYYY"),r=moment().subtract(1,"days").format("DD/MM/YYYY");function o(e,t){$("#_drnovc").daterangepicker({singleDatePicker:!1,showDropdowns:!1,startDate:e,endDate:t,showWeekNumbers:!1,autoUpdateInput:!0,opens:"left",drops:"down",autoApply:!1,alwaysShowCalendars:!0,linkedCalendars:!1,buttonClasses:"btn btn-sm fontq",applyButtonClasses:"btn-custom fw4 px-3 opa8",cancelClass:"btn-link fw4 text-gris",ranges:{"1° Semestre":[moment().startOf("year"),moment().startOf("year").add(5,"month").endOf("month")],"2° Semestre":[moment().startOf("year").add(6,"month"),moment().startOf("year").endOf("year")],"Ultimos 6 meses":[moment().subtract(6,"month"),moment().subtract(1,"days")],"Este Año":[moment().startOf("year"),moment().endOf("year")],"Ultimo Año":[moment().subtract(1,"year"),moment().subtract(1,"days")],"Año Anterior":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")],"1° Semestre Ant.":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").startOf("year").add(5,"month").endOf("month")],"2° Semestre Ant.":[moment().subtract(1,"year").startOf("year").add(6,"month"),moment().subtract(1,"year").startOf("year").endOf("year")]},locale:{format:"DD/MM/YYYY",separator:" al ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Para",customRangeLabel:"Personalizado",weekLabel:"Sem",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1,alwaysShowCalendars:!0,applyButtonClasses:"btn-custom fw5 px-3 opa8"}})}function n(){d.ajax.reload()}$(document).on("click","#trash_allIn",(function(){$(".selectjs_plantas").val(null).trigger("change"),$(".selectjs_empresa").val(null).trigger("change"),$(".selectjs_sectores").val(null).trigger("change"),$(".select_seccion").val(null).trigger("change"),$(".select_seccion").prop("disabled",!0),$(".selectjs_grupos").val(null).trigger("change"),$(".selectjs_sucursal").val(null).trigger("change"),$(".selectjs_personal").val(null).trigger("change"),$(".selectjs_tipoper").val(null).trigger("change"),d.page.len(10).draw(),$("#GetConceptosAusentes").DataTable().page.len(10).draw(),$("#datoPorLegajo").val("1"),CheckedInput("#PorLegajo"),$("#ordenar").val("0"),sessionStorage.setItem(e+"_ordenar",$("#ordenar").val()),d.order([0,"asc"]).draw(),$("#rowFiltros").collapse("hide"),n(),sessionStorage.clear();var t=moment().subtract(6,"month").format("DD/MM/YYYY"),a=moment().subtract(1,"days").format("DD/MM/YYYY");$("#_drnovc").val(t+" al "+a),o(t,a)})),o(a,r);var s=sessionStorage.getItem(e+"_ordenar");$("#_drnovc").change((function(){sessionStorage.setItem(e+"_range",$("#_drnovc").val()),n()})),sessionStorage.getItem(e+"_range")&&$("#_drnovc").val(sessionStorage.getItem(e+"_range")),s?"0"==s?$("#PorLegajo").prop("checked",!0):$("#PorNombre").prop("checked",!0):($("#ordenar").val("0"),$("#PorLegajo").prop("checked",!0)),sessionStorage.setItem(e+"_ordenar",$("#ordenar").val()),$("#PorLegajo").change((function(t){t.preventDefault(),1==document.getElementById("PorLegajo").checked&&($("#ordenar").val("0"),sessionStorage.setItem(e+"_ordenar",$("#ordenar").val())),d.order([0,"asc"]).draw(),setTimeout((function(){d.columns.adjust().draw()}),100)})),$("#PorNombre").change((function(t){t.preventDefault(),1==document.getElementById("PorNombre").checked&&($("#ordenar").val("1"),sessionStorage.setItem(e+"_ordenar",$("#ordenar").val())),d.order([1,"asc"]).draw(),setTimeout((function(){d.columns.adjust().draw()}),100)}));var l='.xls <img src="../../img/xls.png" class="w15" alt="Exportar Excel">';ActiveBTN(!1,"#btnExcel","Exportando",l);var c='.csv <img src="../../img/csv.png" class="w15" alt="Exportar a Csv">';ActiveBTN(!1,"#btnCsv","Exportando",c);var d=$("#GetPresentismo").DataTable({initComplete:function(e,t){$("#GetPresentismo_filter").prepend('<button title="Exportar Excel" type="button" class="mr-1 btn btn-light text-success fw5 border btn-sm fontq" id="btnExcel">.xls <img src="../../img/xls.png" class="w15" alt="Exportar Excel"></button>'),$("#GetPresentismo_filter").prepend('<button title="Exportar Csv" type="button" class="mr-1 btn btn-light text-success fw5 border btn-sm fontq" id="btnCsv">.csv <img src="../../img/csv.png" class="w15" alt="Exportar a Csv"></button>')},fnDrawCallback:function(e){$(document).on("click","#btnExcel",(function(t){t.preventDefault(),$("#rowFiltros").collapse("hide");var a,r=JSON.stringify(e.json);a=r,$.ajax({type:"POST",dataType:"json",url:"FicExcel.php",data:{datos:a},beforeSend:function(){ActiveBTN(!0,"#btnExcel","Exportando",l)},success:function(e){"ok"==e.status&&(ActiveBTN(!1,"#btnExcel","Exportando",l),window.location=e.archivo)},error:function(){ActiveBTN(!1,"#btnExcel","Exportando",l)}}),t.stopImmediatePropagation()})),$(document).on("click","#btnCsv",(function(t){t.preventDefault(),$("#rowFiltros").collapse("hide");var a,r=JSON.stringify(e.json);a=r,$.ajax({type:"POST",dataType:"json",url:"FicCsv.php",data:{datos:a},beforeSend:function(){ActiveBTN(!0,"#btnCsv","Exportando",c)},success:function(e){"ok"==e.status&&(ActiveBTN(!1,"#btnCsv","Exportando",c),window.location=e.archivo)},error:function(){ActiveBTN(!1,"#btnCsv","Exportando",c)}}),t.stopImmediatePropagation()}))},lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Todo"]],columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:1},{orderable:!1,targets:2},{orderable:!1,targets:3},{orderable:!1,targets:4},{orderable:!1,targets:5},{orderable:!1,targets:6},{orderable:!1,targets:7},{orderable:!1,targets:8},{orderable:!1,targets:9}],bProcessing:!0,stateSave:!0,stateDuration:-1,ajax:{url:"getPresentismo.php?v="+$.now(),type:"POST",data:function(e){e.fecha=$("#_drnovc").val(),e.ordenar=$("#ordenar").val(),e.Emp=$("#Emp").val(),e.Plan=$("#Plan").val(),e.Sect=$("#Sect").val(),e.Sec2=$("#Sec2").val(),e.Grup=$("#Grup").val(),e.Sucur=$("#Sucur").val(),e.Tipo=$("#Tipo").val(),e.Per=$("#Per").val()},error:function(){}},columns:[{class:"",data:"legajo"},{class:"text-wrap",data:"nombre"},{class:"text-center",data:"desde"},{class:"text-center",data:"hasta"},{class:"text-center",data:"_presentes"},{class:"text-center",data:"_ausentes"},{class:"text-center",data:"_totaldias"},{class:"text-center",data:"_convpres"},{class:"text-center",data:"_convaus"},{class:"text-center",data:"_totalmesesconv"}],scrollY:"50vh",bScrollCollapse:!0,deferRender:!0,bLengthChange:!0,paging:!0,searching:!0,info:!0,ordering:!0,responsive:!1,autoWidth:!0,language:{url:"../../js/DataTableSpanishShort2.json?v="+vjs()}});setTimeout((function(){d.columns.adjust().draw()}),100)}));