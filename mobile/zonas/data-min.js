function clean(){$("#table-zonas").DataTable().search("").draw(),$("#divtable").removeClass("col-sm-6"),$("#divmap").removeClass("col-sm-6"),$(".divmap").addClass("d-none"),$("#geocomplete").val(""),$("input[name=lat]").val(""),$("input[name=lng]").val(""),$("input[name=nombre]").val(""),$("input[name=metros]").val(""),$("input[name=alta_zona]").val("true"),$("#reset").hide()}$(".select2").select2({minimumResultsForSearch:-1,placeholder:"Seleccionar"}),$((function(){var a=new google.maps.LatLng(-38.416097,-63.616671);$("#geocomplete").geocomplete({map:".map_canvas",details:"form",markerOptions:{draggable:!0,icon:"../../img/marker.png"},mapOptions:{scrollwheel:!0,scaleControl:!0,zoomControl:!0,streetViewControl:!1,fullscreenControl:!0,disableDefaultUI:!0},types:["geocode","establishment"],country:"ar"});var e=$("#geocomplete").geocomplete("map");e.setCenter(a),e.setZoom(4),$("#geocomplete").bind("geocode:dragged",(function(a,e){$("input[name=lat]").val(e.lat()),$("input[name=lng]").val(e.lng()),$("#reset").show()})),$("#reset").click((function(){return $("#geocomplete").geocomplete("resetMarker"),$("#geocomplete").geocomplete("map"),$("#reset").hide(),!1})),$("#find").click((function(){$("#geocomplete").trigger("geocode")})).click()})),$("#Refresh").on("click",(function(){CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("tbody").addClass("opa2"),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!."),clean(),marcadores=[]}));let marcadores=new Array,table=$("#table-zonas").DataTable({initComplete:function(a,e){},drawCallback:function(a){$("tbody").removeClass("opa2"),$("#Refresh").prop("disabled",!1),$("#Refresh").html("Actualizar Grilla")},bProcessing:!0,ajax:{url:"array_zonas.php",type:"POST",dataSrc:"zonas",data:function(a){}},createdRow:function(a,e,t){$(a).addClass("animate__animated animate__fadeIn align-middle")},columns:[{class:"w30",data:"ver"},{class:"w200",data:"name"},{class:"w40",data:"map_size"},{class:"w40",data:"eliminar"},{class:"",data:"null"}],deferRender:!0,lengthMenu:[[10,50,100,300,500,700,900,1e3],[10,50,100,300,500,700,900,1e3]],paging:!0,searching:!0,scrollY:"50vh",scrollX:!0,scrollCollapse:!0,info:!0,ordering:!1,language:{url:"../../js/DataTableSpanishShort2.json"}}),getMarcadores=(a="",e="")=>(marcadores=[],firstLat=a,firstLng=e,$("#table-zonas td .marcador").each((function(){obj=JSON.parse($(this).attr("marcador"));let e=`<div class='p-3 shadow-sm bg-white'><label class='w40 fontq'>Zona: </label> <span class='font-weight-bold'>${obj.name}</span><br><label class='w40 fontq'>Radio: </label> <span class='font-weight-bold'>${obj.map_size}</span></div>`;marcadores.push([obj.name,parseFloat(obj.lat),parseFloat(obj.lng),e]),a||(firstLat=parseFloat(obj.lat),firstLng=parseFloat(obj.lng))})),a&&(firstLat=a,firstLng=e),marcadores);function initMap(){var a=parseFloat($("#latitud").val()),e=parseFloat($("#longitud").val()),t=$("#zona").val();const o=parseFloat($("#map_size").val()),n={lat:a,lng:e},l=new google.maps.Map(document.getElementById("maps"),{zoom:16,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,mapTypeId:"terrain"}),s='<div id="content"><span class="font-weight-bold text-secondary">'+t+"</span></div>",r=new google.maps.InfoWindow({content:s}),i=new google.maps.Marker({position:n,map:l,icon:"../../img/marker.png",title:t});i.addListener("click",(()=>{r.open(l,i)}));var d={strokeColor:"#0388D1",strokeOpacity:1,strokeWeight:1,fillColor:"#0388D1",fillOpacity:.25,map:l,center:n,radius:o};cityCircle=new google.maps.Circle(d),cityCircle.bindTo("center",i,"position")}table.on("draw.dt",(function(a,e){$("#map").html("").removeClass("shadow").css("height","0px"),$("#mapTitle").html(" "),""!=getMarcadores()&&$("#btnVerMarcadores").html('<a href="#positionMap" class="btn btn-custom fontq" id="VerMarcadores"><span class="mr-1">Mapa</span><i class="bi bi-pin-map-fill"></i></a>')})),$(document).on("click",".EliminaZona",(function(a){CheckSesion();var e=$(this).attr("data4"),t=$(this).attr("data5");$("#_nombreZona").html(t),$("#d_tk").val(e),$("#d_nombre").val(t)})),$(document).on("click","#Zona",(function(a){CheckSesion(),$("#VerZonas").addClass("d-none"),$("#rowNuevaZona").removeClass("d-none"),$("#geocomplete").attr("autocomplete","_chweb_off"),fadeInOnly("#rowNuevaZona")})),$(document).on("click","#cancelZone",(function(a){CheckSesion(),$("#VerZonas").removeClass("d-none"),$("#rowNuevaZona").addClass("d-none"),fadeInOnly("#VerZonas"),clean()})),$(document).on("click",".verZone",(function(a){CheckSesion(),fadeInOnly("#divmap");var e=$(this).attr("data"),t=$(this).attr("data1"),o=$(this).attr("data2"),n=$(this).attr("data3");$("#latitud").val(e),$("#longitud").val(t),$("#zona").val(o),$("#map_size").val(n),$("#divtable").addClass("col-sm-6"),$("#divmap").addClass("col-sm-6"),$(".divmap").removeClass("d-none"),$("#MarkerName").html(""),$("#MarkerName").html(o),$("#NombreZona").html('Zona: <span class="font-weight-bold text-secondary">'+o+"</span> "),$("#MarkerMapSize").html(""),$("#MarkerMapSize").html("Radio: "+n),$("#RadioZona").html(' Radio: <span class="font-weight-bold text-secondary">'+n+" mts.</span>"),$("#_lat").val(e),$("#_lng").val(t),$("#_name").val(o),$("#_map_size").val(n),$(".marker").attr("data-id",e),$(".marker").attr("data-lat",e),$(".marker").attr("data-lng",t),initMap()})),$("#DZona").bind("submit",(function(a){CheckSesion(),a.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(a){$("#btnsi").prop("disabled",!0),$("#btnsi").html("Eliminando.!"),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!.")},success:function(a){"ok"==a.status?(clean(),CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("tbody").addClass("opa2"),$("#btnsi").prop("disabled",!1),$("#btnsi").html("S&iacute;"),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!."),$("#EliminaZona").modal("hide")):(CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("tbody").addClass("opa2"),$("#btnsi").prop("disabled",!1),$("#btnsi").html("S&iacute;"),$("#Refresh").prop("disabled",!1),$("#Refresh").html("Actualizar Grilla"),$("#EliminaZona").modal("hide"))},error:function(){CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("tbody").addClass("opa2"),$("#btnsi").prop("disabled",!1),$("#btnsi").html("S&iacute;"),$("#Refresh").prop("disabled",!1),$("#Refresh").html("Actualizar Grilla"),$("#EliminaZona").modal("hide")}})})),$("#CrearZona").bind("submit",(function(a){a.preventDefault(),CheckSesion(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(a){$("#btnSubmitZone").prop("disabled",!0),$("#btnSubmitZone").html("Creando Zona.!")},success:function(a){"ok"==a.status?(CheckSesion(),$("#table-zonas").DataTable().search(a.zona).draw(),$("#table-zonas").DataTable().ajax.reload(),$("#divtable").addClass("col-sm-6"),$("#divmap").addClass("col-sm-6"),$(".divmap").removeClass("d-none"),$("#zona").val(a.zona),$("#map_size").val(a.radio),$("#latitud").val(a.lat),$("#longitud").val(a.lng),$("#NombreZona").html('Zona: <span class="font-weight-bold text-secondary">'+a.zona+"</span> "),$("#RadioZona").html(' Radio: <span class="font-weight-bold text-secondary">'+a.radio+" mts.</span>"),initMap(),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!"),$("#btnSubmitZone").prop("disabled",!1),$("#btnSubmitZone").html("Crear Zona"),$("#geocomplete").val(""),$("input[name=lat]").val(""),$("input[name=lng]").val(""),$("input[name=nombre]").val(""),$("input[name=metros]").val(""),$("#reset").hide(),$("#VerZonas").removeClass("d-none"),$("#rowNuevaZona").addClass("d-none"),fadeInOnly("#VerZonas")):(CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!"),$("#btnSubmitZone").prop("disabled",!1),$("input[name=lat]").val(""),$("input[name=lng]").val(""),$("input[name=nombre]").val(""),$("input[name=metros]").val(""),$("#reset").hide())},error:function(){CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("#Refresh").prop("disabled",!0),$("#Refresh").html("Actualizando!"),$("#btnSubmitZone").prop("disabled",!1),$("input[name=lat]").val(""),$("input[name=lng]").val(""),$("input[name=nombre]").val(""),$("input[name=metros]").val(""),$("#reset").hide()}})})),$(".selectjs_cuentaToken").select2({multiple:!1,language:"es",placeholder:"Cambiar de Cuenta",minimumInputLength:"0",minimumResultsForSearch:5,maximumInputLength:"10",selectOnClose:!1,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(a){var e="Máximo 10 caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(e+="es"),e},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar 0 o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:"../GetTokenCuenta.php",dataType:"json",type:"POST",data:function(a){return{}},processResults:function(a){return{results:a}}}}),$(".selectjs_cuentaToken").on("select2:select",(function(a){CheckSesion(),$("#RefreshToken").submit(),$("#map").html("").removeClass("shadow").css("height","0px")})),$("#RefreshToken").bind("submit",(function(a){a.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(a){CheckSesion()},success:function(a){"ok"==a.status&&(CheckSesion(),$("#table-zonas").DataTable().ajax.reload(),$("tbody").addClass("opa2"),clean())},error:function(){CheckSesion()}})})),$(document).on("click","#VerMarcadores",(function(a){var e,t;$("#map").css("height","400px").css("width","100%").addClass("shadow"),$("#VerMarcadores").hide(),getMarcadores(),$("#mapTitle").html('<div class="py-2 fontq">Total Zonas: '+marcadores.length+"</div>"),t={zoom:10,center:new google.maps.LatLng(firstLat,firstLng),mapTypeId:google.maps.MapTypeId.TERRAIN,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0},function(a,t){for(var o=0;o<t.length;o++){var n=new google.maps.LatLng(t[o][1],t[o][2]);!function(o,n){google.maps.event.addListener(n,"click",(function(){e||(e=new google.maps.InfoWindow),e.setContent(t[o][3]),e.open(a,n)}))}(o,new google.maps.Marker({position:n,map:a,title:t[o][0]}))}}(new google.maps.Map(document.getElementById("map"),t),marcadores)}));