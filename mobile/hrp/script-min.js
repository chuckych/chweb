function loadingTable(a){$(a+" td div").addClass("bg-light text-light"),$(a+" td img").addClass("invisible")}function loadingTableRemove(a){$(a+" td div").removeClass("bg-light text-light"),$(a+" td img").removeClass("invisible")}function dateRange(){$("#_drMob").daterangepicker({singleDatePicker:!1,showDropdowns:!1,minYear:$("#aniomin").val(),maxYear:$("#aniomax").val(),showWeekNumbers:!1,autoUpdateInput:!0,opens:"right",drops:"down",minDate:$("#min").val(),startDate:$("#min").val(),maxDate:$("#max").val(),endDate:$("#max").val(),autoApply:!1,alwaysShowCalendars:!0,linkedCalendars:!1,buttonClasses:"btn btn-sm fontq",applyButtonClasses:"btn-custom fw4 px-3 opa8",cancelClass:"btn-link fw4 text-gris",ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Esta semana":[moment().day(1),moment().day(7)],"Semana Anterior":[moment().subtract(1,"week").day(1),moment().subtract(1,"week").day(7)],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes anterior":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Últimos 30 días":[moment().subtract(29,"days"),moment()]},locale:{format:"DD/MM/YYYY",separator:" al ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Para",customRangeLabel:"Personalizado",weekLabel:"Sem",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1,alwaysShowCalendars:!0,applyButtonClasses:"btn-custom fw5 px-3 opa8"}})}$(document).ready((function(){})),$("#Encabezado").addClass("pointer");let drmob2=$("#min").val()+" al "+$("#max").val();function initMap(){var a=parseFloat($("#latitud").val()),t=parseFloat($("#longitud").val()),e=(e=$("#zona").val())||"Fuera de Zona",n=parseFloat($("#map_size").val());const o={lat:a,lng:t},i=new google.maps.Map(document.getElementById("mapzone"),{zoom:15,center:o,mapTypeId:google.maps.MapTypeId.TERRAIN,zoomControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0}),l='<div id="content"><span>'+e+"</span></div>",s=new google.maps.InfoWindow({content:l}),r=new google.maps.Marker({position:o,map:i,icon:"../../img/marker.png",title:e});r.addListener("click",(()=>{s.open(i,r)}));var d={strokeColor:"#0388D1",strokeOpacity:1,strokeWeight:1,fillColor:"#0388D1",fillOpacity:.25,map:i,center:o,radius:n};cityCircle=new google.maps.Circle(d),cityCircle.bindTo("center",r,"position")}function clean(){$("#mapzone").addClass("d-none"),$("#map_size").val("5")}$("#_drMob2").val(drmob2),tablemobile=$("#table-mobile").DataTable({initComplete:function(a,t){$("#table-mobile_filter").append('<button data-titlel="Usuarios"type="button" class="h35 mx-1 btn btn-custom btn-sm px-3 openModal"><i class="bi bi-people-fill"></i></button><button data-titlel="Actualizar registros" class="btn btn-sm btn-custom fontq actualizar h35 px-3"><i class="bi bi-cloud-download"></i></button>'),$(".dr").append('<div><input type="text" readonly  class="mx-2 form-control text-center w250 ls1" name="_dr" id="_drMob"></div>'),dateRange(),$("#_drMob").on("apply.daterangepicker",(function(a,t){$("#_drMob2").val($("#_drMob").val()),CheckSesion(),$("#table-mobile").DataTable().ajax.reload()}))},drawCallback:function(a){classEfect("#table-mobile tbody","animate__animated animate__fadeIn"),setTimeout((function(){loadingTableRemove("#table-mobile")}),100),$(".form-control-sm").attr("placeholder","Buscar")},dom:"<'row'<'col-12 col-sm-6 d-flex align-items-start dr'l><'col-12 col-sm-6 d-flex align-items-start justify-content-end'f>><'row'<'col-12'tr>><'row'<'col-sm-12 col-md-6 d-flex align-items-start'i><'col-sm-12 col-md-6 d-flex justify-content-end'p>>",ajax:{url:"getRegMobile.php",type:"POST",data:function(a){a._drMob=$("#_drMob").val(),a._drMob2=$("#_drMob2").val()}},createdRow:function(a,t,e){$(a).addClass("animate__animated animate__fadeIn align-middle")},columns:[{data:"face_url"},{class:"",data:"name"},{class:"ls1",data:"Fecha2"},{class:"",data:"Fecha"},{class:"ls1 fw5 text-center",data:"time"},{class:"text-center",data:"mapa"},{class:"text-center",data:"eventType"},{class:"ls1",data:"phoneid"}],bProcessing:!0,serverSide:!0,deferRender:!0,searchDelay:1e3,paging:!0,searching:!0,info:!0,ordering:!1,language:{url:"../../js/DataTableSpanishShort2.json"}}),$(document).on("click",".pic",(function(a){$("#pic").modal("show");var t=$(this).attr("datafoto"),e=$(this).attr("dataname"),n=$(this).attr("datauid"),o=$(this).attr("datacerteza"),i=$(this).attr("datacerteza2"),l=$(this).attr("datainout"),s=$(this).attr("datazone"),r=$(this).attr("datahora"),d=($(this).attr("datagps"),$(this).attr("datatype")),c=$(this).attr("datadia"),m=$(this).attr("datalat"),p=$(this).attr("datalng");$("#latitud").val(m),$("#longitud").val(p),$("input[name=lat]").val(m),$("input[name=lng]").val(p),$("#zona").val(s),t?$(".picFoto").html('<img loading="lazy" src= "'+t+'" class="w150 img-fluid rounded"/>'):$(".picFoto").html('<img loading="lazy" src="../img/user.png" class="img-fluid rounded" alt="Sin Foto" title="Sin Foto">'),$(".picName").html(e),$(".picUid").html(n),$(".picHora").html("<b>"+r+"</b>"),$(".picModo").html(l),$(".picTipo").html(d),$(".picDia").html(c);var u=parseFloat(m)+parseFloat(p);if(o>70?$(".picCerteza").html('<img src="../img/check.png" class="w15" alt="'+o+'" title="'+o+'">&nbsp;<span class="fontp fw4 text-success">('+i+")</span>"):$(".picCerteza").html('<img src="../img/uncheck.png" class="w15" alt="'+o+'" title="'+o+'">&nbsp;<span class="fontp fw4 text-danger">('+i+")</span>"),"0"!=u){s?$("#btnCrearZona").addClass("d-none"):$("#btnCrearZona").removeClass("d-none");var b=s?'<span class="text-success">'+s+"</span>":'<span class="text-danger">Fuera de Zona</span>';$(".picZona").html(b)}else $(".picZona").html("Sin ubicaci&oacute;n");"0"!=u?($("#mapzone").removeClass("d-none"),initMap()):($("#mapzone").addClass("d-none"),$("#btnCrearZona").addClass("d-none")),$(document).on("click","#btnCrearZona",(function(a){fadeInOnly("#rowCreaZona"),$("#rowRespuesta").addClass("d-none"),$("#map_size").val("200"),initMap(),fadeInOnly("#mapzone"),$(".select2").on("select2:select",(function(a){var t=$(a.currentTarget).val();$("#map_size").val(t),initMap(),fadeInOnly("#mapzone")})),$("#rowCreaZona").removeClass("d-none"),$("#CrearZona").bind("submit",(function(a){a.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(a){$("#btnSubmitZone").prop("disabled",!0),$("#btnSubmitZone").html("Creando Zona.!")},success:function(a){"ok"==a.status?($("#btnCrearZona").addClass("d-none"),$("#btnSubmitZone").prop("disabled",!1),$("#btnSubmitZone").html("Aceptar"),$("#rowRespuesta").removeClass("d-none"),$("#respuesta").html('<div class="alert alert-success fontq"><b>¡Zona creada correctamente!<br>La misma se ver&aacute; reflejada en futuras marcaciones.</b></div>'),$("#rowCreaZona").addClass("d-none"),setTimeout((function(){$("#rowRespuesta").addClass("d-none")}),4e3),$("#map_size").val(a.radio),initMap()):($("#btnSubmitZone").prop("disabled",!1),$("#btnSubmitZone").html("Aceptar"))},error:function(){$("#btnSubmitZone").prop("disabled",!1),$("#btnSubmitZone").html("Aceptar")}})}))})),$(document).on("click","#cancelZone",(function(a){clean(),initMap()}))})),$("#pic").on("hidden.bs.modal",(function(a){clean()}));let loading='<div class="spinner-border fontppp" role="status" style="width: 15px; height:15px" ></div>';function actualizar(){$.ajax({type:"POST",url:"actualizar.php",beforeSend:function(a){ActiveBTN(!0,".actualizar",loading,'<i class="bi bi-cloud-download"></i>'),notify('Actualizando registros <span class = "dotting mr-1"> </span> '+loading,"dark",6e4,"right")},success:function(a){"ok"==a.status?($.notifyClose(),ActiveBTN(!1,".actualizar",loading,'<i class="bi bi-cloud-download"></i>'),notify(a.Mensaje,"success",2e3,"right"),minmaxDate()):($.notifyClose(),ActiveBTN(!1,".actualizar",loading,'<i class="bi bi-cloud-download"></i>'),notify(a.Mensaje,"info",2e3,"right"))},error:function(){$.notifyClose(),ActiveBTN(!1,".actualizar","Actualizando.."+loading,'Actualizar <i class="bi bi-cloud-download"></i>'),notify("Error","danger",2e3,"right")}})}function minmaxDate(){$.ajax({type:"POST",url:"minmaxdate.php",success:function(a){let t=a,e=t.min,n=t.max,o=e+" al "+n;$("#min").val(e),$("#max").val(n),$("#_drMob2").val(o),$("#_drMob").val(o),dateRange(),tablemobile.ajax.reload()}})}$(document).on("click",".actualizar",(function(a){actualizar()})),$(document).on("click","#Encabezado",(function(a){CheckSesion(),tablemobile.ajax.reload()})),tablemobile.on("processing.dt",(function(a,t,e){loadingTable("#table-mobile")})),$(document).on("click",".openModal",(function(a){$("#modalUsuarios").modal("show")}));