$((function(){"use strict";function t(t){let e="";switch(t){case"A":e="Alta";break;case"B":e="Baja";break;case"M":e="Modificación";break;case"P":e="Proceso";break;default:e=row.tipo;break}return e}let e=$("#tableAuditoria").dataTable({lengthMenu:[[5,10,25,50,100],[5,10,25,50,100]],bProcessing:!1,serverSide:!0,deferRender:!0,dom:"<'row fila invisible animate__animated animate__fadeInDown'<'col-12 col-sm-6 d-flex justify-content-start'l<'filtros'>><'col-12 col-sm-6 d-flex justify-content-end'f<'ml-1 _dr'><'refresh'>>><'row'<'col-12 divFiltros'>><'row animate__animated animate__fadeIn'<'col-12'tr>><'row animate__animated animate__fadeIn'<'col-12 col-sm-5'i><'col-12 col-sm-7 d-flex justify-content-end'p>>",ajax:{url:"getAuditoria.php?"+$.now(),type:"POST",dataType:"json",data:function(t){t._dr=$("#_dr").val()},error:function(){$("#tablePersonal").css("display","none")}},createdRow:function(t,e,a){$(t).addClass("animate__animated animate__fadeIn")},columns:[{className:"",targets:"",title:"Usuario",render:function(t,e,a,n){return'<div class="pointer" data="'+a.id_sesion+'" data-titler="Usuario: '+a.nombre+'"><span class="fw5">'+a.nombre+'</span><br><span class="">'+a.usuario+"</span></div>"}},{className:"text-center",targets:"",title:"ID Sesion",render:function(t,e,a,n){return"<div>"+a.id_sesion+"</div>"}},{className:"",targets:"",title:"Cuenta",render:function(t,e,a,n){return"<div>"+a.audcuenta_nombre+"</div>"}},{className:"ls1",targets:"",title:"Fecha",render:function(t,e,a,n){return"<div>"+moment(a.fecha).format("DD/MM/YYYY")+"</div>"}},{className:"ls1",targets:"",title:"Hora",render:function(t,e,a,n){return"<div>"+a.hora+"</div>"}},{className:"text-center",targets:"",title:"Tipo",render:function(e,a,n,r){return'<div data-titlel="'+t(n.tipo)+'">'+n.tipo+"</div>"}},{className:"w-100 text-wrap",targets:"",title:"Dato",render:function(t,e,a,n){return'<div data-titlel="'+a.dato+'">'+a.dato+"</div>"}}],paging:!0,searching:!0,info:!0,ordering:0,responsive:0,language:{url:"../../js/DataTableSpanishShort2.json?"+vjs()}});function a(t,e,a=""){let n=moment(t,"YYYY"),r=moment(e,"YYYY");a=a||e,$("#_dr").daterangepicker({singleDatePicker:!1,showDropdowns:!0,minYear:parseInt(n),maxYear:parseInt(r),startDate:a,endDate:e,minDate:t,maxDate:e,showWeekNumbers:!1,autoUpdateInput:!0,opens:"center",drops:"down",autoApply:!1,alwaysShowCalendars:!0,linkedCalendars:!1,buttonClasses:"btn btn-sm fontq",applyButtonClasses:"btn-custom fw4 px-3 opa8",cancelClass:"btn-link fw4 text-gris",ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Ultimos 7 Días":[moment().subtract(6,"days"),moment()],"Ultimos 30 Días":[moment().subtract(29,"days"),moment()],"Este Mes":[moment().startOf("month"),moment().endOf("month")],"Ultimo Mes":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Todo el Periodo":[t,e]},locale:{format:"DD/MM/YYYY",separator:" al ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Para",customRangeLabel:"Personalizado",weekLabel:"Sem",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1,alwaysShowCalendars:!0,applyButtonClasses:"btn-custom fw5 px-3 opa8"}}),$("#_dr").on("apply.daterangepicker",(function(t,e){$("#tableAuditoria").DataTable().ajax.reload()}))}e.on("init.dt",(function(t,e){$("#tableAuditoria_length select").addClass("h35"),$("#tableAuditoria_filter input").attr("placeholder","Buscar dato.."),fetch("getFechas.php").then((t=>t.json())).then((t=>{$("._dr").html('<label><input title="Filtrar Fecha" type="text" id="_dr" class="form-control h35 text-center ls1 w250" autocomplete=off></label>'),$(".refresh").html('<label><button data-titlel="Actualizar Grilla"class="btn ml-1 h35 btn-custom fontq" id="refresh"><i class="bi bi-arrow-repeat"></i></button></label>'),$(".filtros").html('<div class="d-inline-flex align-items-center"><button data-titler="Filtros" class="btn ml-1 h35 btn-outline-custom border fontq" id="filtros" type="button" data-toggle="collapse" data-target="#collapseFiltros" aria-expanded="false" aria-controls="collapseFiltros">Filtros</button><span id="trash_all" data-titler="Limpiar Filtros" class="mx-2 bi bi-trash fontq text-secondary pointer"></span></div>'),fetch("filtros.html?v="+vjs()).then((t=>t.text())).then((t=>{$(".divFiltros").html(t),$(".fila").removeClass("invisible")})),a(moment(t.start_date).format("DD/MM/YYYY"),moment(t.end_date).format("DD/MM/YYYY"));let e=moment($("#_dr").data("daterangepicker").endDate._d).format("YYYYMMDD");$("#refresh").on("click",(function(){fetch("getFechas.php").then((t=>t.json())).then((t=>{let n=moment($("#_dr").data("daterangepicker").startDate._d).format("DD/MM/YYYY"),r=moment(t.end_date).format("DD/MM/YYYY"),o=moment(t.end_date).format("YYYYMMDD"),s=parseInt(e)<parseInt(o)?o:e;parseInt(e)<parseInt(s)?(a(n,r,n),e=s,$("#tableAuditoria").DataTable().ajax.reload()):$("#tableAuditoria").DataTable().ajax.reload(null,!1)}))}))}))})),e.on("page.dt",(function(){$("#tableAuditoria div").addClass("bg-light text-light")})),e.on("draw.dt",(function(){$("#tableAuditoria div").removeClass("bg-light text-light"),$("#divTableAud").show()})),onOpenSelect2()}));