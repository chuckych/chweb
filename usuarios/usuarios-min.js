$(document).ready((function(){$(".requerido").addClass("fontp ml-1 ls1"),$(".requerido").html("(*)");var t=$("#GetUsuarios").DataTable({initComplete:function(t,e){},drawCallback:function(t){$(".dataTables_info").addClass("text-secondary"),$(".custom-select").addClass("text-secondary"),$(".contentd").removeClass("text-light bg-light w30"),$(".botones").show(),$(".table-responsive").removeClass("invisible"),fadeInOnly(".table-responsive"),$(".dataTables_length").addClass("d-none d-sm-block"),setTimeout((()=>{$(window).width()<769?$(".botones").removeClass("float-right"):$(".botones").addClass("float-right")}),100)},lengthMenu:[5,10,25,50,100],columnDefs:[{visible:!1,targets:0},{visible:!1,targets:1},{visible:!1,targets:2},{visible:!0,targets:3},{visible:!1,targets:6},{visible:!1,targets:8},{visible:!1,targets:9},{visible:!0,targets:10},{visible:!1,targets:11},{visible:!1,targets:15}],rowGroup:{dataSrc:["nombre"]},bProcessing:!0,serverSide:!0,deferRender:!0,iDisplayLenght:5,searchDelay:1500,dom:"<'row'<'col-sm-3 d-none d-sm-block'l><'col-sm-9 col-12 d-inline-flex w-100 justify-content-end'f>><'row'<'col-12 table-responsive invisible'tr>><'row'<'col-sm-5 d-none d-sm-block'i><'col-sm-7 col-12 d-none d-sm-block'p>><'row d-sm-none d-block'<'d-flex justify-content-center fixed-bottom col-12 bg-white'p>>",ajax:{url:"GetUsuarios.php",type:"POST",data:function(t){t.recid_c=$("#recid_c").val()},error:function(){$("#GetUsuarios_processing").hide()}},columns:[{class:"",data:"uid"},{class:"",data:"recid"},{class:"",data:"nombre"},{class:"border-0 pb-2 text-nowrap",data:"usuario"},{class:"border-0",data:"legajo"},{class:"border-0",data:"rol_n"},{class:"",data:"estado"},{class:"border-0",data:"estado_n"},{class:"",data:"id_cliente"},{class:"",data:"recid_cliente"},{class:"border-0",data:"cliente"},{class:"",data:"rol"},{class:"border-0",data:"last_access"},{class:"border-0",data:"fecha_alta"},{class:"border-0",data:"fecha_mod"},{class:"text-nowrap",data:"Buttons"}],paging:!0,responsive:!1,info:!0,searching:!0,ordering:!1,language:{url:"../js/DataTableSpanishShort.json"}});t.on("page.dt",(function(){CheckSesion(),$(".open-modal").removeClass("btn-outline-custom"),$(".contentd").addClass("text-light bg-light w30"),$(".botones").hide(),$("#respuestaResetClave").html("")})),t.on("init.dt",(function(){$(".form-control-sm").attr("placeholder","Buscar nombre o rol"),$("#GetUsuarios_filter").prepend('<button data-titlel="Alta de Usuario" class="px-2 btn btn-outline-custom add fontq border"><svg class="" width="20" height="20" fill="currentColor"><use xlink:href="../img/bootstrap-icons.svg#person-plus-fill"/></svg></button>'),$(window).width()<769?$(".botones").removeClass("float-right"):$(".botones").addClass("float-right")})),""!=$("#_rol").val()&&$("#GetUsuarios").DataTable().search($("#_rol").val()).draw(),$(window).width()<769?($("#GetUsuarios").removeClass("text-wrap"),$("#GetUsuarios").addClass("text-nowrap")):($("#GetUsuarios").removeClass("text-nowrap"),$("#GetUsuarios").addClass("text-wrap")),$(document).on("click",".editar",(function(t){CheckSesion(),$.notifyClose(),t.preventDefault(),$("#modalEditUser").modal("show");let e=$(this).attr("data_uid"),a=$(this).attr("data_tarjeta"),o=$(this).attr("data_nombre"),s=$(this).attr("data_usuario"),n=$(this).attr("data_rol_n"),r=$(this).attr("data_rol"),i=$(this).attr("data_legajo");$(this).attr("data_estado_n"),$(this).attr("data_estado"),$(this).attr("data_fecha_alta"),$(this).attr("data_fecha_mod"),$(this).attr("data_cliente");$("#data_nombre").html(o),$("#e_nombre").val(o),$("#e_usuario").val(s),$("#e_legajo").val(i),$("#e_uid").val(e),$("#e_tarjeta").val(a);var l="0",d=!1,c="10",u="250",m=!1;$(".selectRol").select2({multiple:!1,allowClear:m,language:"es",dropdownParent:$("#modalEditUser"),placeholder:"Rol",minimumInputLength:l,minimumResultsForSearch:5,maximumInputLength:c,selectOnClose:d,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(t){var e="Máximo "+c+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(e+="es"),e},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+l+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:"getRol.php",dataType:"json",type:"POST",delay:u,data:function(t){return{q:t.term,recid_c:$("#recid_c").val()}},processResults:function(t){return{results:t}}}});var b=new Option(n,r,!1,!0);$(".selectRol").append(b).trigger("change"),ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$("#FormEdit").bind("submit",(function(t){CheckSesion(),t.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(t){ActiveBTN(!0,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(t){"ok"==t.status?(ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify(t.Mensaje,"success",5e3,"right"),$("#modalEditUser").modal("hide"),$("#GetUsuarios").DataTable().ajax.reload()):(ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify(t.Mensaje,"danger",5e3,"right"))}}),t.stopImmediatePropagation()}))})),$("#modalEditUser").on("hidden.bs.modal",(function(){ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$("#data_nombre").html(""),$("#e_nombre").val(""),$("#e_usuario").val(""),$("#e_legajo").val(""),$("#e_uid").val(""),$("#respuestaForm").html("")})),$(document).on("click",".add",(function(t){CheckSesion(),$.notifyClose(),t.preventDefault(),$("#modalAddUser").modal("show"),$("#a_nombre").focus(),$("#a_recid").val($("#recid_c").val());var e="0",a=!1,o="10",s="250",n=!1;$(".selectRol").select2({multiple:!1,allowClear:n,language:"es",dropdownParent:$("#modalAddUser"),placeholder:"Rol",minimumInputLength:e,minimumResultsForSearch:5,maximumInputLength:o,selectOnClose:a,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(t){var e="Máximo "+o+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(e+="es"),e},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+e+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:"getRol.php",dataType:"json",type:"POST",delay:s,data:function(t){return{q:t.term,recid_c:$("#recid_c").val()}},processResults:function(t){return{results:t}}}}),ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#FormAdd").bind("submit",(function(t){CheckSesion(),t.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(t){ActiveBTN(!0,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(t){"ok"==t.status?(ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#GetUsuarios").DataTable().ajax.reload(),$.notifyClose(),notify(t.Mensaje,"success",5e3,"right"),$("#modalAddUser").modal("hide")):(ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify(t.Mensaje,"danger",5e3,"right"))},error:function(t){ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify("Error","danger",5e3,"right")}}),t.stopImmediatePropagation()}))})),$(document).on("click","#GetUsuarios .ListaUsuario",(function(t){CheckSesion(),t.preventDefault();let e=$(this).attr("data-c"),a=$(this).attr("data_nombre"),o=$(this).attr("data_usuario"),s=$(this).attr("data_rol_n"),n="listas_estruct/index.php?uid="+$(this).attr("data-uid")+"&_c="+e+"&nombre="+a+"&usuario="+o+"&rol_n="+s;$.get(n).done((function(t){let e="listas_estruct/tabs.php?v="+vjs();$.get(e).done((function(t){$("#nav-tabContent").html(t),$("#copyListas .nombreUsuario").html(a)})),$("#modalListas .modal-body").html(t),$("#modalListas").modal("show")})),t.stopImmediatePropagation()})),$("#modalAddUser").on("hidden.bs.modal",(function(){ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#a_nombre").val(""),$("#a_usuario").val(""),$("#a_legajo").val(""),$(".selectRol").val(null).trigger("change"),$("#respuestaFormAdd").html("")})),$(document).on("click",".resetKey",(function(t){$.notifyClose(),t.preventDefault();var e=$(this).attr("data_uid"),a=$(this).attr("data_nombre"),o=$(this).attr("data_usuario");$(".resetKey").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Desea restablecer la contraseña de <span class="fw5">'+a+"</span>?<br />Su nueva contraseña será: "+o+"</span>",buttons:{confirm:{label:"Confirmar",className:"btn-custom btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-outline-custom border btn-sm fontq btn-mobile"}},callback:function(t){$(".resetKey").unbind("click"),t&&$.ajax({type:"POST",url:"crud.php",data:{submit:"key",uid:e,nombre:a,usuario:o},beforeSend:function(t){$("#reset_"+e).prop("disabled",!0),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(t){"ok"==t.status?($("#reset_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"success",1e4,"right")):($("#reset_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"danger",5e3,"right"))},error:function(t){$("#reset_"+e).prop("disabled",!1),$.notifyClose(),notify("Error","danger",5e3,"right")}})}}),t.stopImmediatePropagation()})),$(document).on("click",".estado",(function(t){$.notifyClose(),t.preventDefault();var e=$(this).attr("data_uid"),a=$(this).attr("data_nombre"),o=$(this).attr("data_estado"),s=$(this).attr("data_title");$(".estado").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Confirma dar de '+s+' a <span class="fw5">'+a+"</span>?</span>",buttons:{confirm:{label:"Confirmar",className:"btn-custom btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-outline-custom border btn-sm fontq btn-mobile"}},callback:function(t){$(".estado").unbind("click"),t&&$.ajax({type:"POST",url:"crud.php",data:{submit:"estado",uid:e,nombre:a,estado:o},beforeSend:function(t){$("#estado_"+e).prop("disabled",!0),$.notifyClose(),notify("Aguarde","info",0,"right")},success:function(t){"ok"==t.status?($("#estado_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"success",5e3,"right"),$("#GetUsuarios").DataTable().ajax.reload()):($("#estado_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"danger",5e3,"right"))},error:function(t){$("#estado_"+e).prop("disabled",!1),$.notifyClose(),notify("Error","success",5e3,"right")}})}}),t.stopImmediatePropagation()})),$(document).on("click",".delete",(function(t){$.notifyClose(),t.preventDefault();var e=$(this).attr("data_uid"),a=$(this).attr("data_nombre");$(".delete").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Confirma eliminar el usuario/a: <span class="fw5">'+a+"</span>?</span>",buttons:{confirm:{label:"Confirmar",className:"btn-danger btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-light btn-sm fontq btn-mobile"}},callback:function(t){$(".delete").unbind("click"),t&&$.ajax({type:"POST",url:"crud.php",data:{submit:"delete",uid:e,nombre:a},beforeSend:function(t){$("#delete_"+e).prop("disabled",!0),$.notifyClose(),notify("Aguarde","info",0,"right")},success:function(t){"ok"==t.status?($("#delete_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"success",5e3,"right"),$("#GetUsuarios").DataTable().ajax.reload()):($("#delete_"+e).prop("disabled",!1),$.notifyClose(),notify(t.Mensaje,"danger",5e3,"right"))},error:function(t){$("#delete_"+e).prop("disabled",!1),$.notifyClose(),notify("Error","danger",5e3,"right")}})}}),$(".bootbox-confirm .modal-body").addClass("confirmDelete"),t.stopImmediatePropagation()})),$("#modalListas").on("hidden.bs.modal",(function(t){$("#modalListas .modal-body").html(""),$.notifyClose()}))}));