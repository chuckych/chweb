$(document).ready((function(){$(".requerido").addClass("fontp ml-1 ls1"),$(".requerido").html("(*)"),$("#GetUsuarios").DataTable({initComplete:function(e,t){$(".form-control-sm").attr("placeholder","Buscar nombre o rol"),$("#GetUsuarios_filter").prepend('<button tittle="Alta de Usuario" class="px-2 btn btn-outline-custom add fontq border"><svg class="" width="20" height="20" fill="currentColor"><use xlink:href="../img/bootstrap-icons.svg#person-plus-fill"/></svg></button>'),$(window).width()<769?$(".botones").removeClass("float-right"):$(".botones").addClass("float-right")},drawCallback:function(e){$(".dataTables_info").addClass("text-secondary"),$(".custom-select").addClass("text-secondary"),$(".contentd").removeClass("text-light bg-light w30"),$(".botones").show(),$(".table-responsive").removeClass("invisible"),fadeInOnly(".table-responsive"),$(".dataTables_length").addClass("d-none d-sm-block"),setTimeout((()=>{$(window).width()<769?$(".botones").removeClass("float-right"):$(".botones").addClass("float-right")}),100)},lengthMenu:[5,10,25,50,100],columnDefs:[{visible:!1,targets:0},{visible:!1,targets:1},{visible:!1,targets:2},{visible:!0,targets:3},{visible:!1,targets:6},{visible:!1,targets:8},{visible:!1,targets:9},{visible:!0,targets:10},{visible:!1,targets:11},{visible:!1,targets:15}],rowGroup:{dataSrc:["nombre"]},bProcessing:!0,serverSide:!0,deferRender:!0,iDisplayLenght:5,searchDelay:1500,ajax:{url:"GetUsuarios.php",type:"POST",data:function(e){e.recid_c=$("#recid_c").val()},error:function(){$("#GetUsuarios_processing").hide()}},columns:[{class:"",data:"uid"},{class:"",data:"recid"},{class:"",data:"nombre"},{class:"border-0 pb-2",data:"usuario"},{class:"border-0",data:"legajo"},{class:"border-0",data:"rol_n"},{class:"",data:"estado"},{class:"border-0",data:"estado_n"},{class:"",data:"id_cliente"},{class:"",data:"recid_cliente"},{class:"border-0",data:"cliente"},{class:"",data:"rol"},{class:"border-0",data:"last_access"},{class:"border-0",data:"fecha_alta"},{class:"border-0",data:"fecha_mod"},{class:"text-nowrap",data:"Buttons"}],paging:!0,responsive:!1,info:!0,searching:!0,ordering:!1,language:{url:"../js/DataTableSpanishShort.json"}}).on("page.dt",(function(){CheckSesion(),$(".open-modal").removeClass("btn-outline-custom"),$(".contentd").addClass("text-light bg-light w30"),$(".botones").hide(),$("#respuestaResetClave").html("")})),""!=$("#_rol").val()&&$("#GetUsuarios").DataTable().search($("#_rol").val()).draw(),$(window).width()<769?($("#GetUsuarios").removeClass("text-wrap"),$("#GetUsuarios").addClass("text-nowrap")):($("#GetUsuarios").removeClass("text-nowrap"),$("#GetUsuarios").addClass("text-wrap")),$(document).on("click",".editar",(function(e){CheckSesion(),$.notifyClose(),e.preventDefault(),$("#modalEditUser").modal("show");var t=$(this).attr("data_uid"),a=$(this).attr("data_nombre"),o=$(this).attr("data_usuario"),s=$(this).attr("data_rol_n"),r=$(this).attr("data_rol"),n=$(this).attr("data_legajo");$(this).attr("data_estado_n"),$(this).attr("data_estado"),$(this).attr("data_fecha_alta"),$(this).attr("data_fecha_mod"),$(this).attr("data_cliente");$("#data_nombre").html(a),$("#e_nombre").val(a),$("#e_usuario").val(o),$("#e_legajo").val(n),$("#e_uid").val(t);var i="0",l=!1,d="10",c="250",u=!1;$(".selectRol").select2({multiple:!1,allowClear:u,language:"es",dropdownParent:$("#modalEditUser"),placeholder:"Rol",minimumInputLength:i,minimumResultsForSearch:5,maximumInputLength:d,selectOnClose:l,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var t="Máximo "+d+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(t+="es"),t},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+i+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:"getRol.php",dataType:"json",type:"POST",delay:c,data:function(e){return{q:e.term,recid_c:$("#recid_c").val()}},processResults:function(e){return{results:e}}}});var m=new Option(s,r,!1,!0);$(".selectRol").append(m).trigger("change"),ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$("#FormEdit").bind("submit",(function(e){CheckSesion(),e.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(e){ActiveBTN(!0,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(e){"ok"==e.status?(ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify(e.Mensaje,"success",5e3,"right"),$("#modalEditUser").modal("hide"),$("#GetUsuarios").DataTable().ajax.reload()):(ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$.notifyClose(),notify(e.Mensaje,"danger",5e3,"right"))}}),e.stopImmediatePropagation()}))})),$("#modalEditUser").on("hidden.bs.modal",(function(){ActiveBTN(!1,"#submitEdit","Guardando","Guardar"),$("#data_nombre").html(""),$("#e_nombre").val(""),$("#e_usuario").val(""),$("#e_legajo").val(""),$("#e_uid").val(""),$("#respuestaForm").html("")})),$(document).on("click",".add",(function(e){CheckSesion(),$.notifyClose(),e.preventDefault(),$("#modalAddUser").modal("show"),$("#a_nombre").focus(),$("#a_recid").val($("#recid_c").val());var t="0",a=!1,o="10",s="250",r=!1;$(".selectRol").select2({multiple:!1,allowClear:r,language:"es",dropdownParent:$("#modalAddUser"),placeholder:"Rol",minimumInputLength:t,minimumResultsForSearch:5,maximumInputLength:o,selectOnClose:a,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var t="Máximo "+o+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(t+="es"),t},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+t+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:"getRol.php",dataType:"json",type:"POST",delay:s,data:function(e){return{q:e.term,recid_c:$("#recid_c").val()}},processResults:function(e){return{results:e}}}}),ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#FormAdd").bind("submit",(function(e){CheckSesion(),e.preventDefault(),$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),beforeSend:function(e){ActiveBTN(!0,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(e){"ok"==e.status?(ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#GetUsuarios").DataTable().ajax.reload(),$.notifyClose(),notify(e.Mensaje,"success",5e3,"right"),$("#modalAddUser").modal("hide")):(ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify(e.Mensaje,"danger",5e3,"right"))},error:function(e){ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$.notifyClose(),notify("Error","danger",5e3,"right")}}),e.stopImmediatePropagation()}))})),$("#modalAddUser").on("hidden.bs.modal",(function(){ActiveBTN(!1,"#submitAdd","Guardando","Agregar"),$("#a_nombre").val(""),$("#a_usuario").val(""),$("#a_legajo").val(""),$(".selectRol").val(null).trigger("change"),$("#respuestaFormAdd").html("")})),$(document).on("click",".resetKey",(function(e){$.notifyClose(),e.preventDefault();var t=$(this).attr("data_uid"),a=$(this).attr("data_nombre"),o=$(this).attr("data_usuario");$(".resetKey").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Desea restablecer la contraseña de <span class="fw5">'+a+"</span>?<br />Su nueva contraseña será: "+o+"</span>",buttons:{confirm:{label:"Confirmar",className:"btn-custom btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-outline-custom border btn-sm fontq btn-mobile"}},callback:function(e){$(".resetKey").unbind("click"),e&&$.ajax({type:"POST",url:"crud.php",data:{submit:"key",uid:t,nombre:a,usuario:o},beforeSend:function(e){$("#reset_"+t).prop("disabled",!0),$.notifyClose(),notify("Aguarde..","info",0,"right")},success:function(e){"ok"==e.status?($("#reset_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"success",1e4,"right")):($("#reset_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"danger",5e3,"right"))},error:function(e){$("#reset_"+t).prop("disabled",!1),$.notifyClose(),notify("Error","danger",5e3,"right")}})}}),e.stopImmediatePropagation()})),$(document).on("click",".estado",(function(e){$.notifyClose(),e.preventDefault();var t=$(this).attr("data_uid"),a=$(this).attr("data_nombre"),o=$(this).attr("data_estado"),s=$(this).attr("data_title");$(".estado").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Confirma dar de '+s+' a <span class="fw5">'+a+"</span>?</span>",buttons:{confirm:{label:"Confirmar",className:"btn-custom btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-outline-custom border btn-sm fontq btn-mobile"}},callback:function(e){$(".estado").unbind("click"),e&&$.ajax({type:"POST",url:"crud.php",data:{submit:"estado",uid:t,nombre:a,estado:o},beforeSend:function(e){$("#estado_"+t).prop("disabled",!0),$.notifyClose(),notify("Aguarde","info",0,"right")},success:function(e){"ok"==e.status?($("#estado_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"success",5e3,"right"),$("#GetUsuarios").DataTable().ajax.reload()):($("#estado_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"danger",5e3,"right"))},error:function(e){$("#estado_"+t).prop("disabled",!1),$.notifyClose(),notify("Error","success",5e3,"right")}})}}),e.stopImmediatePropagation()})),$(document).on("click",".delete",(function(e){$.notifyClose(),e.preventDefault();var t=$(this).attr("data_uid"),a=$(this).attr("data_nombre");$(".delete").unbind("click"),bootbox.confirm({message:'<span class="fonth fw4">¿Confirma eliminar el usuario/a: <span class="fw5">'+a+"</span>?</span>",buttons:{confirm:{label:"Confirmar",className:"btn-custom btn-sm fontq btn-mobile"},cancel:{label:"Cancelar",className:"btn-outline-custom border btn-sm fontq btn-mobile"}},callback:function(e){$(".delete").unbind("click"),e&&$.ajax({type:"POST",url:"crud.php",data:{submit:"delete",uid:t,nombre:a},beforeSend:function(e){$("#delete_"+t).prop("disabled",!0),$.notifyClose(),notify("Aguarde","info",0,"right")},success:function(e){"ok"==e.status?($("#delete_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"success",5e3,"right"),$("#GetUsuarios").DataTable().ajax.reload()):($("#delete_"+t).prop("disabled",!1),$.notifyClose(),notify(e.Mensaje,"danger",5e3,"right"))},error:function(e){$("#delete_"+t).prop("disabled",!1),$.notifyClose(),notify("Error","danger",5e3,"right")}})}}),e.stopImmediatePropagation()}))}));