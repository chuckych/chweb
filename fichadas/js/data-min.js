$((function(){function e(){a("#GetFichadas"),a("#GetFichadasFecha"),a("#GetPersonal"),a("#GetFechas"),$("#Visualizar").is(":checked")?$("#GetFechas").DataTable().ajax.reload():($("#GetPersonal").DataTable().ajax.reload(),$("#GetFechas").DataTable().ajax.reload(),$("#GetFichadas").show(),$("#Per2").addClass("d-none"),$(".pers_legajo").removeClass("d-none"))}$("#Filtros").on("shown.bs.modal",(function(){CheckSesion()}));let a=e=>{$(e+" td div").addClass("bg-light text-light"),$(e+" td img").addClass("invisible"),$(e+" td i").addClass("invisible"),$(e+" td span").addClass("invisible")},t=e=>{switch(textColor="",e.Tipo){case"Normal":textColor="";break;case"Manual":textColor="text-primary";break;default:textColor="";break}return textColor="Modificada"==e.Esta?"text-danger":textColor,textColor},n={17:!1,18:!1,32:!1,16:!1,39:!1,37:!1,13:!1,27:!1};var s;$(document).keydown((function(e){e.keyCode in n&&(n[e.keyCode]=!0,n[32]&&$("#Filtros").modal("show")),e.keyCode in n&&(n[e.keyCode]=!0,n[27]&&$("#Filtros").modal("hide")),e.keyCode in n&&(n[e.keyCode]=!0,n[39]&&($("#Visualizar").is(":checked")?$("#GetFechas").DataTable().page("next").draw("page"):$("#GetPersonal").DataTable().page("next").draw("page"))),e.keyCode in n&&(n[e.keyCode]=!0,n[37]&&($("#Visualizar").is(":checked")?$("#GetFechas").DataTable().page("previous").draw("page"):$("#GetPersonal").DataTable().page("previous").draw("page")))})).keyup((function(e){e.keyCode in n&&(n[e.keyCode]=!1)})),$("#pagFech").addClass("d-none"),$("#GetFichadasFechaTable").addClass("d-none"),$("#datoFicFalta").val("0"),s="#FicFalta",CheckSesion(),$(s).val(0),$(s).change((function(){$(s).is(":checked")?$(s).val(1):$(s).val(0)})),$("#Visualizar").prop("disabled",!0);const l=$("#GetPersonal").DataTable({pagingType:"full",lengthMenu:[[1],[1]],bProcessing:!1,serverSide:!0,deferRender:!0,searchDelay:1500,dom:'\n    <"row"\n        <"col-12 d-flex justify-content-end p-0"\n            <"d-flex justify-content-end align-items-end">\n            <"d-inline-flex align-items-center"<"mt-2 mt-sm-1"t>\n                <"d-none d-sm-block ml-1"p>\n            >   \n        >\n        <"col-12"\n            <"d-block d-sm-none mt-n2"p>\n            <"d-flex justify-content-end align-items-end mt-n4 p-0"i>\n        >\n    >\n        ',ajax:{url:"/"+$("#_homehost").val()+"/fichadas/GetPersonalFichas.php",type:"POST",data:function(e){e._l=$("#_l").val(),e.Per=$("#Per").val(),e.Per2=$("#Per2").val(),e.Tipo=$("#Tipo").val(),e.Emp=$("#Emp").val(),e.Plan=$("#Plan").val(),e.Sect=$("#Sect").val(),e.Sec2=$("#Sec2").val(),e.Grup=$("#Grup").val(),e.Sucur=$("#Sucur").val(),e._dr=$("#_dr").val(),e.FicFalta=$("#FicFalta").val(),e.onlyReg=$("#onlyReg:checked").val()??""},error:function(){$("#GetPersonal_processing").css("display","none")}},columns:[{className:"w80 px-3 border fw4 bg-light radius pers_legajo",targets:"pers_legajo",render:function(e,a,t,n){return"<div>"+('<input type="text" id="Per2" class="d-none border-0 border bg-white form-control-sm mr-2 w100 text-center" style="height: 20px;"><span class="numlega btn p-0 pointer fontq fw4">'+t.pers_legajo+'</span><input type="hidden" id="_l" value='+t.pers_legajo+">")+"</div>"}},{className:"w300 px-3 border border-left-0 fw4 bg-light radius",targets:"pers_nombre",render:function(e,a,t,n){return'<div class="d-flex align-items-center justify-content-start" style="margin-top:1px"><span>'+t.pers_nombre+"</span></div>"}}],paging:!0,responsive:!1,info:!0,ordering:!1,language:{url:"../js/DataTableSpanishPag.json?"+vjs()}});l.on("draw.dt",(function(e,a,t){$(".dataTables_info").addClass("text-secondary"),$("#GetPersonal thead").remove(),$("#GetPersonal").removeClass("invisible"),a.iDraw>1&&$("#GetFichadas").DataTable().ajax.reload()})),l.on("init.dt",(function(e,n,s){if($("#Per2").mask("000000000"),1==n.iDraw){const e=$("#GetFichadas").DataTable({dom:"<'row'<'col-12 col-sm-6 d-flex align-items-start'l><'col-12 col-sm-6 d-inline-flex align-items-start justify-content-end'f>><'row '<'col-12 table-responsive't>><'row d-none d-sm-block'<'col-12 d-flex bg-transparent align-items-center justify-content-between'<i><p>>><'row d-block d-sm-none'<'col-12 fixed-bottom h70 bg-white d-flex align-items-center justify-content-center'p>><'row d-block d-sm-none'<'col-12 d-flex align-items-center justify-content-center'i>>",lengthMenu:[[5,10,30,60,90],[5,10,30,60,90]],bProcessing:!1,serverSide:!0,deferRender:!0,bStateSave:!0,ajax:{url:"/"+$("#_homehost").val()+"/fichadas/GetFichadas.php",type:"POST",data:function(e){e.Per=$("#Per").val(),e.Tipo=$("#Tipo").val(),e.Emp=$("#Emp").val(),e.Plan=$("#Plan").val(),e.Sect=$("#Sect").val(),e.Sec2=$("#Sec2").val(),e.Grup=$("#Grup").val(),e.Sucur=$("#Sucur").val(),e._dr=$("#_dr").val(),e._l=$("#_l").val(),e.FicFalta=$("#FicFalta").val(),e.onlyReg=$("#onlyReg:checked").val()},error:function(e){$("#GetFichadas").css("display","none")}},columns:[{className:"",targets:"Fic_Lega",title:"LEGAJO",render:function(e,a,t,n){return"<div>"+t.Fic_Lega+"</div>"}},{className:"",targets:"Fic_Nombre",title:"NOMBRE",render:function(e,a,t,n){return"<div>"+t.Fic_Nombre+"</div>"}},{className:"text-center",targets:"Primera",title:'<span data-titler="Primer Fichada">PRIMERA</span>',render:function(e,a,n,s){let l="-",i="",c="";if(n.Fich){return n.Fich.length&&("Modificada"==n.Fich[0].Esta&&(c=". Hora original: "+n.Fich[0].Hora),i=t(n.Fich[0]),l='<span data-titlel="(# 1) '+n.Fich[0].HoRe+" "+n.Fich[0].Tipo+" "+n.Fich[0].Esta+c+'"><span class="ls1">'+n.Fich[0].HoRe+"</span></span>"),'<div class="'+i+'">'+l+"</div>"}}},{className:"text-center",targets:"Ultima",title:'<span data-titler="Última Fichada">ÚLTIMA</span>',render:function(e,a,n,s){let l="-",i="",c="";if(n.Fich){let e=n.Fich.length;e>1&&(e=n.Fich.length-1,item=e+1,"Modificada"==n.Fich[e].Esta&&(c=". Hora original: "+n.Fich[e].Hora),i=t(n.Fich[e]),l='<span data-titlel="(# '+item+") "+n.Fich[e].HoRe+" "+n.Fich[e].Tipo+" "+n.Fich[e].Esta+c+'"><span class="ls1">'+n.Fich[e].HoRe+"</span></span>")}return'<div class="'+i+'">'+l+"</div>"}},{className:"",targets:"Fic_Dia",title:"DÍA",render:function(e,a,t,n){return"<div>"+t.Fic_Dia+"</div>"}},{className:"",targets:"Fic_Fecha",title:"FECHA",render:function(e,a,t,n){return"<div>"+t.Fic_Fecha+"</div>"}},{className:"",targets:"Fic_Horario",title:"HORARIO",render:function(e,a,t,n){return"<div>"+t.Fic_Horario+"</div>"}},{className:"",targets:"Fichadas",title:"FICHADAS",render:function(e,a,n,s){let l="",i="",c=[];return n.Fich.length>0?(l="("+n.Fich.length+") ",$.each(n.Fich,(function(e,a){"Modificada"==a.Esta&&(i=". Hora original: "+a.Hora),c.push('<span data-titlel="'+a.HoRe+" "+a.Tipo+" "+a.Esta+i+'" class="'+t(a)+'"> <span class="ls1">'+a.HoRe+"</span></span>")})),"<div>"+l+" "+c+"</div>"):""}}],searching:!1,ordering:!1,language:{url:"../js/DataTableSpanishShort2.json?"+vjs()}});e.on("init.dt",(function(e,a,t){$("#Refresh").prop("disabled",!1),$("#trash_all").removeClass("invisible"),$(".Filtros").prop("disabled",!1),$("#GetFichadasTable").fadeIn(),$("#GetFichadasTable").removeClass("invisible")})),e.on("page.dt",(function(){CheckSesion(),a("#GetFichadas")}))}})),l.on("page.dt",(function(e,t,n){CheckSesion(),a("#GetPersonal"),a("#GetFichadas"),t.iDraw&&setTimeout((()=>{$("#GetFichadas").DataTable().ajax.reload()}),50)}));const i=$("#GetFechas").DataTable({pagingType:"full",lengthMenu:[[1],[1]],bProcessing:!1,serverSide:!0,deferRender:!0,dom:'\n    <"row"\n        <"col-12 d-flex justify-content-end p-0"\n            <"d-flex justify-content-end align-items-end">\n            <"d-inline-flex align-items-center"<"mt-2 mt-sm-1"t>\n                <"d-none d-sm-block ml-1"p>\n            >   \n        >\n        <"col-12"\n            <"d-block d-sm-none mt-n2"p>\n            <"d-flex justify-content-end align-items-end mt-n4 p-0"i>\n        >\n    >\n        ',ajax:{url:"/"+$("#_homehost").val()+"/fichadas/GetFechasFichas.php",type:"POST",data:function(e){e.Per=$("#Per").val(),e.Tipo=$("#Tipo").val(),e.Emp=$("#Emp").val(),e.Plan=$("#Plan").val(),e.Sect=$("#Sect").val(),e.Sec2=$("#Sec2").val(),e.Grup=$("#Grup").val(),e.Sucur=$("#Sucur").val(),e._dr=$("#_dr").val(),e._l=$("#_l").val(),e.FicFalta=$("#FicFalta").val(),e.onlyReg=$("#onlyReg:checked").val()},error:function(){$("#GetFecha_processing").css("display","none")}},columns:[{className:"w80 px-3 border fw4 bg-light radius ls1",targets:"FechaFormat",render:function(e,a,t,n){return"<div>"+("<span>"+t.FechaFormat+'</span><input type="hidden" class="" id="_f" value='+t.Fecha+">")+"</div>"}},{className:"w300 px-3 border fw4 bg-light radius",targets:"Dia",render:function(e,a,t,n){return'<div class="">'+t.Dia+"</div>"}}],paging:!0,responsive:!1,info:!0,ordering:!1,language:{url:"../js/DataTableSpanishPagFech.json?"+vjs()}});function c(e,a,t,n,s,l){let i="0",c=!1,r="10",o="250",d=!0;$(e).select2({multiple:a,allowClear:d,language:"es",dropdownParent:l,placeholder:t,minimumInputLength:i,minimumResultsForSearch:5,maximumInputLength:r,selectOnClose:c,language:{noResults:function(){return"No hay resultados.."},inputTooLong:function(e){var a="Máximo "+r+" caracteres. Elimine "+overChars+" caracter";return 1!=overChars&&(a+="es"),a},searching:function(){return"Buscando.."},errorLoading:function(){return"Sin datos.."},inputTooShort:function(){return"Ingresar "+i+" o mas caracteres"},maximumSelected:function(){return"Puede seleccionar solo una opción"}},ajax:{url:s,dataType:"json",type:"POST",delay:o,cache:!1,data:function(e){return{q:e.term,estruct:n,Per:$("#Per").val(),Tipo:$("#Tipo").val(),Emp:$("#Emp").val(),Plan:$("#Plan").val(),Sect:$("#Sect").val(),Sec2:$("#Sec2").val(),Grup:$("#Grup").val(),Sucur:$("#Sucur").val(),_dr:$("#_dr").val(),_l:$("#_l").val(),FicFalta:$("#FicFalta").val()}},processResults:function(e){return{results:e}}}})}function r(){CheckSesion(),$(".selectjs_plantas").val(null).trigger("change"),$(".selectjs_empresa").val(null).trigger("change"),$(".selectjs_sectores").val(null).trigger("change"),$(".select_seccion").val(null).trigger("change"),$(".select_seccion").prop("disabled",!0),$(".selectjs_grupos").val(null).trigger("change"),$(".selectjs_sucursal").val(null).trigger("change"),$(".selectjs_personal").val(null).trigger("change"),$(".selectjs_tipoper").val(null).trigger("change"),$("#FicFalta").prop("checked",!1),$("#FicFalta").val(0),$("#Per2").val(null)}i.on("init.dt",(function(e,n,s){if($("#GetFechas").removeClass("invisible"),$("#GetFechas thead").remove(),$("#GetFichadasFechaTable").removeClass("invisible"),$(".dataTables_info").addClass("text-secondary"),1==n.iDraw){const e=$("#GetFichadasFecha").DataTable({dom:"<'row'<'col-12 col-sm-6 d-flex align-items-start'l><'col-12 col-sm-6 d-inline-flex align-items-start justify-content-end'f>><'row '<'col-12 table-responsive't>><'row d-none d-sm-block'<'col-12 d-flex bg-transparent align-items-center justify-content-between'<i><p>>><'row d-block d-sm-none'<'col-12 fixed-bottom h70 bg-white d-flex align-items-center justify-content-center'p>><'row d-block d-sm-none'<'col-12 d-flex align-items-center justify-content-center'i>>",lengthMenu:[[5,10,30,60,90],[5,10,30,60,90]],bProcessing:!1,serverSide:!0,deferRender:!0,bStateSave:!0,ajax:{url:"/"+$("#_homehost").val()+"/fichadas/GetFichadasFecha.php",type:"POST",data:function(e){e._f=$("#_f").val(),e.Per=$("#Per").val(),e.Tipo=$("#Tipo").val(),e.Emp=$("#Emp").val(),e.Plan=$("#Plan").val(),e.Sect=$("#Sect").val(),e.Sec2=$("#Sec2").val(),e.Grup=$("#Grup").val(),e.Sucur=$("#Sucur").val(),e._dr=$("#_dr").val(),e._l=$("#_l").val(),e.FicFalta=$("#FicFalta").val(),e.onlyReg=$("#onlyReg:checked").val()},error:function(){$("#GetFichadasFecha_processing").css("display","none")}},columns:[{className:"",targets:"Fic_Lega",title:"LEGAJO",render:function(e,a,t,n){return"<div>"+t.Fic_Lega+"</div>"}},{className:"",targets:"Fic_Nombre",title:"NOMBRE",render:function(e,a,t,n){return"<div>"+t.Fic_Nombre+"</div>"}},{className:"text-center",targets:"Primera",title:'<span data-titler="Primer Fichada">PRIMERA</span>',render:function(e,a,n,s){let l="-",i="",c="";if(n.Fich){return n.Fich.length&&("Modificada"==n.Fich[0].Esta&&(c=". Hora original: "+n.Fich[0].Hora),i=t(n.Fich[0]),l='<span data-titlel="(# 1) '+n.Fich[0].HoRe+" "+n.Fich[0].Tipo+" "+n.Fich[0].Esta+c+'"><span class="ls1">'+n.Fich[0].HoRe+"</span></span>"),'<div class="'+i+'">'+l+"</div>"}}},{className:"text-center",targets:"Ultima",title:'<span data-titler="Última Fichada">ÚLTIMA</span>',render:function(e,a,n,s){let l="-",i="",c="";if(n.Fich){let e=n.Fich.length;e>1&&(e=n.Fich.length-1,item=e+1,"Modificada"==n.Fich[e].Esta&&(c=". Hora original: "+n.Fich[e].Hora),i=t(n.Fich[e]),l='<span data-titlel="(# '+item+") "+n.Fich[e].HoRe+" "+n.Fich[e].Tipo+" "+n.Fich[e].Esta+c+'"><span class="ls1">'+n.Fich[e].HoRe+"</span></span>")}return'<div class="'+i+'">'+l+"</div>"}},{className:"",targets:"Fic_Dia",title:"DÍA",render:function(e,a,t,n){return"<div>"+t.Fic_Dia+"</div>"}},{className:"",targets:"Fic_Fecha",title:"FECHA",render:function(e,a,t,n){return"<div>"+t.Fic_Fecha+"</div>"}},{className:"",targets:"Fic_Horario",title:"HORARIO",render:function(e,a,t,n){return"<div>"+t.Fic_Horario+"</div>"}},{className:"",targets:"Fichadas",title:"FICHADAS",render:function(e,a,n,s){let l="",i="",c=[];return n.Fich.length>0?(l="("+n.Fich.length+") ",$.each(n.Fich,(function(e,a){"Modificada"==a.Esta&&(i=". Hora original: "+a.Hora),c.push('<span data-titlel="'+a.HoRe+" "+a.Tipo+" "+a.Esta+i+'" class="'+t(a)+'"> <span class="ls1">'+a.HoRe+"</span></span>")})),"<div>"+l+" "+c+"</div>"):""}}],paging:!0,info:!0,searching:!1,ordering:!1,language:{url:"../js/DataTableSpanishShort2.json?"+vjs()}});e.on("init.dt",(function(e,a,t){$("#GetFichadasFecha").removeClass("invisible"),$(".Filtros").prop("disabled",!1),$("#Visualizar").prop("disabled",!1)})),e.on("page.dt",(function(){CheckSesion(),a("#GetFichadasFecha")}))}})),i.on("page.dt",(function(){CheckSesion(),a("#GetFechas"),a("#GetFichadasFecha"),setTimeout((()=>{$("#GetFichadasFecha").DataTable().ajax.reload()}),50)})),i.on("draw.dt",(function(e,a,t){a.iDraw>1&&$("#GetFichadasFecha").DataTable().ajax.reload()})),$("#Refresh").on("click",(function(a){a.preventDefault(),CheckSesion(),e()})),$("#_dr").change((function(e){e.preventDefault(),a("#GetFichadas"),a("#GetFichadasFecha"),CheckSesion()})),$("#_dr").on("apply.daterangepicker",(function(a,t){e()})),document.getElementById("VerPor").innerHTML="Visualizar por Fecha",$("#Visualizar").change((function(){CheckSesion(),$("#Visualizar").is(":checked")?($("#GetFechas").DataTable().ajax.reload(),$("#GetFichadasTable").hide(),$("#GetFichadasFechaTable").show(),$("#pagLega").addClass("d-none"),$("#pagFech").removeClass("d-none"),$("#GetFichadasFechaTable").removeClass("d-none")):($("#GetPersonal").DataTable().ajax.reload(),$("#GetFichadasTable").show(),$("#GetFichadasFechaTable").hide(),$("#pagLega").removeClass("d-none"),$("#pagFech").addClass("d-none"))})),$("#Tipo").css({width:"200px"}),$(".form-control").css({width:"100%"}),$("#Filtros").on("shown.bs.modal",(function(){let e="/"+$("#_homehost").val()+"/fichadas/getSelect/getEstruct.php";c(".selectjs_empresa",!0,"Empresas","Empr",e,$("#Filtros")),c(".selectjs_plantas",!0,"Plantas","Plan",e,$("#Filtros")),c(".selectjs_sectores",!0,"Sectores","Sect",e,$("#Filtros")),c(".select_seccion",!0,"Secciones","Sec2",e,$("#Filtros")),c(".selectjs_grupos",!0,"Grupos","Grup",e,$("#Filtros")),c(".selectjs_sucursal",!0,"Sucursales","Sucu",e,$("#Filtros")),c(".selectjs_personal",!0,"Legajos","Lega",e,$("#Filtros")),c(".selectjs_tipoper",!1,"Tipo de Personal","Tipo",e,$("#Filtros"));function a(e){$(e).on("select2:select",(function(e){CheckSesion(),$("#Per2").val(null)}))}function t(e){$(e).on("select2:unselecting",(function(e){CheckSesion(),$("#Per2").val(null)}))}a(".selectjs_empresa"),a(".selectjs_plantas"),a(".select_seccion"),a(".selectjs_grupos"),a(".selectjs_sucursal"),a(".selectjs_personal"),a(".selectjs_tipoper"),t(".selectjs_empresa"),t(".selectjs_plantas"),t(".select_seccion"),t(".selectjs_grupos"),t(".selectjs_sucursal"),t(".selectjs_personal"),t(".selectjs_tipoper"),$(".selectjs_sectores").on("select2:select",(function(e){CheckSesion(),$("#Per2").val(null),$(".select_seccion").prop("disabled",!1),$(".select_seccion").val(null).trigger("change");var a=$(".selectjs_sectores :selected").text();$("#DatosFiltro").html("Sector: "+a)})),$(".selectjs_sectores").on("select2:unselecting",(function(e){CheckSesion(),$("#Per2").val(null),$(".select_seccion").prop("disabled",!0),$(".select_seccion").val(null).trigger("change")})),$(".selectjs_personal").on("select2:select",(function(e){CheckSesion(),$("#Per2").val(null)}))})),onOpenSelect2(),$("#Filtros").on("hidden.bs.modal",(function(a){CheckSesion(),e()})),$("#trash_all").on("click",(function(){CheckSesion(),$("#Filtros").modal("show"),r(),$("#Filtros").modal("hide"),e()})),$("#trash_allIn").on("click",(function(){CheckSesion(),r()})),$(document).on("click",".numlega",(function(e){CheckSesion(),$("#Per2").val(null),$(this).addClass("d-none"),$("#Per2").removeClass("d-none"),$("#Per2").focus()})),function(a){$(document).on("change",a,(function(a){$("#Filtros").modal("show"),CheckSesion(),$(".selectjs_plantas").val(null).trigger("change"),$(".selectjs_empresa").val(null).trigger("change"),$(".selectjs_sectores").val(null).trigger("change"),$(".select_seccion").val(null).trigger("change"),$(".select_seccion").prop("disabled",!0),$(".selectjs_grupos").val(null).trigger("change"),$(".selectjs_sucursal").val(null).trigger("change"),$(".selectjs_personal").val(null).trigger("change"),$(".selectjs_tipoper").val(null).trigger("change"),$("#Filtros").modal("hide"),e(),l.on("xhr",(function(){l.ajax.json().recordsTotal?$("#GetFichadasTable").removeClass("d-none"):$("#GetFichadasTable").addClass("d-none")}))}))}("#Per2")}));