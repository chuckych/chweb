$((function(){const e=$("#_c").val(),t=$("#_r").val();var a="tablePersonal";function n(){$("#tableplantas").DataTable().ajax.reload(null,!1),$("#tableempresas").DataTable().ajax.reload(null,!1),$("#tablesucur").DataTable().ajax.reload(null,!1),$("#tablegrupos").DataTable().ajax.reload(null,!1),$("#tablesector").DataTable().ajax.reload(null,!1),$("#tabletareas").DataTable().ajax.reload(null,!1)}function s(){$(".trSelect").removeClass("trSelect"),$(".trSelect").removeClass("trSelectPer"),$(".btnAction").remove()}let r=window.matchMedia("(max-width: 700px)");function l(e,t,a,s,r,l,o){$(a).DataTable({initComplete:function(){$(a+" thead").remove(),$(a+"_filter .form-control").removeClass("form-control-sm"),$(a+"_filter .form-control").attr("placeholder","Buscar personal")},drawCallback:function(e){var t,s;$(a+" thead").remove(),$(a).show(),$(".btns").html('<div class="d-flex justify-content-between"><div class="d-flex align-items-center border"><div class="fontq btn btn-link" id="CheckAll"><span class="d-none d-sm-block">Marcar</span><span class="d-block d-sm-none"><i class="bi bi-check2-all"></i></span></div><div class="fontq btn btn-link" id="UnCheckAll"><span class="d-none d-sm-block">Desmarcar</span><span class="d-block d-sm-none"><i class="bi bi-dash"></i></span></div></div><div class="d-inline-flex"><select class="form-control selectEstruc w200" name="selectEstruc"></select><button type="submit" class="submit btn btn-sm btn-custom fontq ml-1 px-3" id="cambiaEmp">Aceptar</i></button></div></div>'),select2Ajax(".selectEstruc",r,!0,!1,l),t="Reasign",s=o,$("#FormPerson").bind("submit",(function(e){e.preventDefault(),$(".selectEstruc").val()?$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize()+"&tipo="+t+"&value="+s+"&EstructName="+$(".selectEstruc option:selected").text(),beforeSend:function(e){ActiveBTN(!0,".submit","Aguarde..","Aceptar")},success:function(e){"ok"==e.status?(notify(e.Mensaje,"success",2e3,"center"),n(),$("#tablePersonal").DataTable().ajax.reload()):(ActiveBTN(!1,".submit","Aguarde..","Aceptar"),notify(e.Mensaje,"danger",2e3,"center"))},error:function(e){ActiveBTN(!1,".submit","Aguarde..","Aceptar"),notify("Error","danger",2e3,"center")}}):notify("Debe seleccionar una Empresa","danger",4e3,"center"),e.stopImmediatePropagation()})),CheckUncheck("#CheckAll","#UnCheckAll",$(".checkReg"))},dom:"<'row mt-2'<'col-12 col-sm-6 d-flex align-items-start'p><'col-12 col-sm-6 mt-2 mt-sm-0'f>><'row'<'col-12 btns'>><'row'<'col-12'tr>><'row'<'col-sm-12 col-md-6 d-flex align-items-start'i><'col-sm-12 col-md-6 d-flex justify-content-end'l>>",lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"Todo"]],iDisplayLength:5,bLengthChange:!0,ajax:{url:s,type:"POST",data:function(a){a.estruc=t,a.cod=e},error:function(){}},columnDefs:[{className:"align-middle py-4 text-center Check pointer",targets:0},{className:"align-middle w-100 Check pointer",targets:1},{className:"align-middle CheckPersonal Check pointer",targets:2},{className:"align-middle Check pointer",targets:3}],deferRender:!0,bProcessing:!0,bLengthChange:!0,paging:!0,searching:!0,info:!0,ordering:!1,autoWidth:!0,language:{url:"../../js/DataTableSpanishTotal.json?v="+vjs()}})}function o(e,t,a,n){$.ajax({type:"post",dataType:"html",url:"formulario.php?v="+vjs(),data:{Cod:e,Desc:t,Tipo:a},beforeSend:function(e){$(n).html('<div class="p-3 text-secondary animate__animated animate__fadeIn">Cargando..</div>')}}).done((function(e){$(n).html(e),s()}))}function i(n,i,c,d,m,p,u,b,h,f,g,v,_,k,w,C,x){tableDT=$(n).DataTable({initComplete:function(){$(n+" thead").remove(),$(n+"_filter").append('<a href="'+b+'" data-title="Agregar '+w+'" type="button" class="ml-1 btn btn-custom btn-sm" id="'+i+'"><i class="bi2 bi-plus"></i></a>'),$("#"+i).click((function(){o("","",f,b)})),$(n+"_filter .form-control").removeClass("form-control-sm"),$(n+"_filter .form-control").attr("placeholder",h)},drawCallback:function(e){$(n+" thead").remove()},dom:"<'row mt-2'<'col-12 col-sm-6 d-flex align-items-start'p><'col-12 col-sm-6 mt-2 mt-sm-0'f>><'row'<'col-12'tr>><'row'<'col-sm-12 col-md-6 d-flex align-items-start'i><'col-sm-12 col-md-6 d-flex justify-content-end'l>>",lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"Todo"]],stateSave:!0,stateDuration:-1,iDisplayLength:5,bLengthChange:!0,ajax:{url:c,type:"POST",data:function(e){},error:function(){}},columnDefs:[{className:m,targets:0},{className:p,targets:1},{className:u,targets:2}],deferRender:!0,bProcessing:!0,bLengthChange:!0,paging:!0,searching:!0,info:!0,ordering:!1,autoWidth:!0,language:{url:"../../js/DataTableSpanishTotal.json?v="+vjs()}}),$(n+" tbody").on(r.matches?"click":"mouseenter",d,(function(r){r.preventDefault(),s(),$(this).parents("tr").addClass("trSelect");let i=$(n).DataTable().row($(this).parents("tr")).data(),c="/"+_homehost+"/data/"+C+"?_c="+e+"&_r"+t;$(this).html(function(e,t,a,n,s){if("0"==e)return'<div class="d-flex align-items-center justify-content-between">'+t+'<div class=""><a href="'+s+'" data-title="Ver personal afectado" type="button" id="view'+a+e+'n" class="animate__animated animate__fadeIn btnAction mr-1 fontq btn btn-custom px-2 btn-sm view"><i class="bi2 bi-people-fill"></i></a></div></div>';return'<div class="d-flex align-items-center justify-content-between">'+t+'<div class=""><a href="'+s+'" data-title="Ver personal afectado" type="button" id="view'+a+e+'n" class="animate__animated animate__fadeIn btnAction mr-1 fontq btn btn-custom px-2 btn-sm view"><i class="bi2 bi-people-fill"></i></a><a href="'+s+'" data-title="Editar '+t+'" type="button" id="'+a+e+'n" class="animate__animated animate__fadeIn btnAction fontq mr-1 btn btn-custom px-2 btn-sm" id="EditEmpresas" value="1"><i class="bi2 bi-pencil"></i></a><a href="'+s+'" data-title="Eliminar  '+t+'" type="button" id="'+n+e+'n" class="animate__animated animate__fadeIn btnAction fontq btn btn-custom px-2 btn-sm"><i class="bi2 bi-trash"></i></a></div>'}(i[0],i[1],g,v,b)),$("#"+g+i[0]+"n").show(),$("#"+v+i[0]+"n").show(),$("#"+g+i[0]+"n").click((function(e){e.preventDefault(),o(i[0],i[1],k,b)})),$("#"+v+i[0]+"n").click((function(e){e.preventDefault(),o(i[0],i[1],_,b)})),$("#view"+g+i[0]+"n").click((function(e){e.preventDefault(),$(b).html(""),$(".selectEstruc").focus(),$(b).html('<form action="'+x+'" method="post" id="FormPerson"><div class="animate__animated animate__fadeIn"><p class="mt-3 fontq w-100">'+w+': <span class="fw5"><input type="hidden" name="EstructActual" value="'+i[0]+"@"+i[1]+'">'+i[1]+'</span class="fw5"></p><table class="table-responsive table text-nowrap w-100 border table-hover" style="display: none"id="'+a+'"></table></div></form>'),l(i[0],w,"#"+a,"getPersonalEstruct.php","Reasignar "+w,c,w),$("#"+a+" tbody").on("click",".Check",(function(e){e.preventDefault();let t=$("#"+a).DataTable().row($(this).parents("tr")).data();$("#Check"+t[0]).is(":checked")?($("#Check"+t[0]).prop("checked",!1),$(this).parents("tr").removeClass("table-active")):($("#Check"+t[0]).prop("checked",!0),$(this).parents("tr").addClass("table-active"))}))}))})),$(n).on("mouseleave",d,(function(){s()})),$(n).mouseenter().off("mouseenter")}function c(){$("#actionForm_e").html(""),$("#actionForm_suc").html(""),$("#actionForm_grupos").html(""),$("#actionForm_tareas").html(""),$("#actionForm_sector").html(""),$("#actionForm").html("")}i("#tableempresas","AddEmpresas","getEmpresas.php",".CheckEmpresas","align-middle val pointer py-4 text-center","align-middle val pointer CheckEmpresas w-100","align-middle pointer","#actionForm_e","Buscar empresa","c_empresas","editEmpresas","deleteEmpresas","d_empresas","u_empresas","Empresa","getEmpresas.php","crud.php"),i("#tableplantas","AddPlantas","getPlantas.php",".CheckPlantas","align-middle val pointer py-4 text-center","align-middle val pointer CheckPlantas w-100","align-middle pointer","#actionForm","Buscar planta","c_plantas","editPlantas","deletePlantas","d_plantas","u_plantas","Planta","getPlantas.php","crud.php"),i("#tablesucur","AddSucur","getSucur.php",".CheckSucur","align-middle val pointer py-4 text-center","align-middle val pointer CheckSucur w-100","align-middle pointer","#actionForm_suc","Buscar sucursal","c_sucur","editSucur","deleteSucur","d_sucur","u_sucur","Sucursal","getSucursales.php","crud.php"),i("#tablegrupos","AddGrupos","getGrupos.php",".CheckGrupos","align-middle val pointer py-4 text-center","align-middle val pointer CheckGrupos w-100","align-middle pointer","#actionForm_grupos","Buscar grupo","c_grupos","editGrupos","deleteGrupos","d_grupos","u_grupos","Grupo","getGrupos.php","crud.php"),i("#tablesector","AddSector","getSector.php",".CheckSector","align-middle val pointer py-4 text-center","align-middle val pointer CheckSector w-100","align-middle pointer","#actionForm_sector","Buscar sector","c_sector","editSector","deleteSector","d_sector","u_sector","Sector","getSectores.php","crud.php"),i("#tabletareas","AddTarea","getTareas.php",".CheckTarea","align-middle val pointer py-4 text-center","align-middle val pointer CheckTarea w-100","align-middle pointer","#actionForm_tareas","Buscar tarea","c_tareas","editTarea","deleteTarea","d_tareas","u_tareas","Tarea","gettareas.php","crud.php"),$("#Encabezado").addClass("pointer"),$("#Encabezado").on("click",(function(){n()})),$("#empresas-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))})),$("#plantas-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))})),$("#sucur-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))})),$("#grupos-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))})),$("#sector-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))})),$("#tareas-tab").on("shown.bs.tab",(function(e){c(),sessionStorage.setItem("activeTabEstruct",$(e.target).attr("href"))}));let d=sessionStorage.getItem("activeTabEstruct");d&&$('.nav-tabs a[href="'+d+'"]').tab("show")}));